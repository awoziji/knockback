/*
  knockback-core.js 1.2.2
  Copyright (c)  2011-2017 Kevin Malakoff.
  License: MIT (http://www.opensource.org/licenses/mit-license.php)
  Source: https://github.com/kmalakoff/knockback
  Dependencies: Knockout.js, Backbone.js, and Underscore.js (or LoDash.js).
  Optional dependencies: Backbone.ModelRef.js and BackboneORM.
*/
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("backbone"),require("underscore"),require("knockout")):"function"==typeof define&&define.amd?define(["backbone","underscore","knockout"],t):"object"==typeof exports?exports.kb=t(require("backbone"),require("underscore"),require("knockout")):e.kb=t(e.Backbone,e._,e.ko)}(this,function(e,t,r){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=24)}([function(e,t,r){"use strict";(function(t){function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=void 0,s=void 0,l=null!=l?l:t,u=r(23),c=["release","destroy","dispose"],f=function(){function e(){i(this,e)}return o(e,null,[{key:"initClass",value:function(){this.VERSION="1.2.2",this.TYPE_UNKNOWN=0,this.TYPE_SIMPLE=1,this.TYPE_ARRAY=2,this.TYPE_MODEL=3,this.TYPE_COLLECTION=4,this.ignore=(null!=u.dependencyDetection?u.dependencyDetection.ignore:void 0)||function(e,t,r){var n=null;return u.computed(function(){return n=e.apply(t,r||[])}).dispose(),n}}},{key:"wasReleased",value:function(e){return!e||e.__kb_released}},{key:"isReleaseable",value:function(t,r){if(null==r&&(r=0),!t||t!==Object(t)||t.__kb_released)return!1;if(u.isObservable(t)||t instanceof e.ViewModel)return!0;if("function"==typeof t||e.isModel(t)||e.isCollection(t))return!1;for(var n=0,i=c.length;n<i;n++){if("function"==typeof t[c[n]])return!0}if(r>0)return!1;for(var o in t){var a=t[o];if("__kb"!==o&&e.isReleaseable(a,r+1))return!0}return!1}},{key:"release",value:function(t){var r=void 0,n=void 0,i=void 0;if(e.isReleaseable(t)){if(t.__kb_released=!0,!a.isArray(t)){if(u.isObservable(t)&&a.isArray(r=e.peek(t))){if(t.__kb_is_co||t.__kb_is_o&&t.valueType()===e.TYPE_COLLECTION)return"function"==typeof t.destroy?t.destroy():void 0;for(n in r)i=r[n],e.isReleaseable(i)&&(r[n]=null,e.release(i));return void("function"==typeof t.dispose&&t.dispose())}for(var o=0,s=c.length;o<s;o++){var l=c[o];if("function"==typeof t[l])return t[l].call(t)}return u.isObservable(t)?void 0:this.releaseKeys(t)}for(n in t)i=t[n],e.isReleaseable(i)&&(t[n]=null,e.release(i))}}},{key:"releaseKeys",value:function(t){for(var r in t){var n=t[r];"__kb"!==r&&e.isReleaseable(n)&&(t[r]=null,e.release(n))}}},{key:"releaseOnNodeRemove",value:function(t,r){return t||e._throwUnexpected(this,"missing view model"),r||e._throwUnexpected(this,"missing node"),u.utils.domNodeDisposal.addDisposeCallback(r,function(){return e.release(t)})}},{key:"renderTemplate",value:function(t,r,n){var i=void 0;if(null==n&&(n={}),!(i=null!=l?l.document:void 0))return"undefined"!=typeof console&&null!==console?console.log("renderTemplate: document is undefined"):void 0;var o=i.createElement("div"),a=u.renderTemplate(t,r,n,o,"replaceChildren");if(1===o.childNodes.length)o=o.childNodes[0];else if(o.childNodes.length)for(var s=0,c=o.childNodes.length,f=c>=0;f?s<=c:s>=c;f?s++:s--)try{u.storedBindingContextForNode(o,u.contextFor(o.childNodes[s]));break}catch(e){}return e.releaseOnNodeRemove(r,o),a.dispose(),r.afterRender&&!n.afterRender&&r.afterRender(o),o}},{key:"applyBindings",value:function(t,r){if(r.length){var n=void 0,i=[document.createElement("div"),r];r=i[0],n=i[1],a.each(n,function(e){return r.appendChild(e)})}return u.applyBindings(t,r),e.releaseOnNodeRemove(t,r),r}},{key:"getValue",value:function(t,r,i){if(t)return a.isFunction(t[r])&&(null!=e.settings.orm?e.settings.orm.useFunction(t,r):void 0)?t[r]():i?t.get.apply(t,n(a.map([r].concat(i),function(t){return e.peek(t)}))):t.get(r)}},{key:"setValue",value:function(t,r,n){var i=void 0;if(t)return a.isFunction(t[r])&&(null!=e.settings.orm?e.settings.orm.useFunction(t,r):void 0)?t[r](n):((i={})[r]=n,t.set(i))}},{key:"_throwMissing",value:function(e,t){throw(a.isString(e)?e:e.constructor.name)+": "+t+" is missing"}},{key:"_throwUnexpected",value:function(e,t){throw(a.isString(e)?e:e.constructor.name)+": "+t+" is unexpected"}},{key:"publishMethods",value:function(t,r,n){a.each(n,function(n){t[n]=e._.bind(r[n],r)})}},{key:"peek",value:function(t){return u.isObservable(t)?t.peek?t.peek():e.ignore(function(){return t()}):t}},{key:"isModel",value:function(t){return t&&(t instanceof e.Model||"function"==typeof t.get&&"function"==typeof t.bind)}},{key:"isCollection",value:function(t){return t&&t instanceof e.Collection}}]),e}();f.initClass(),e.exports=f,l.Parse?(s=f.Parse=l.Parse,a=f._=l.Parse._):(s=f.Backbone=r(21),a=f._=r(22)),f.ko=u,f.Collection=s.Collection,f.Model=s.Object||s.Model,f.Events=s.Events,f.assign=a.assign||a.extend}).call(t,r(3))},function(e,t,r){"use strict";var n=r(0),i=n._,o={default:null,"backbone-orm":null,"backbone-associations":r(19),"backbone-relational":r(20)};n.settings={orm:o.default};for(var a in o){var s=o[a];if(s&&s.isAvailable()){n.settings.orm=s;break}}e.exports=function(e){null==e&&(e={});for(a in e){var t=e[a];switch(a){case"orm":if(i.isString(t)){if(!o.hasOwnProperty(t)){console.log("Knockback configure: could not find orm: "+t+". Available: "+i.keys(o).join(", "));continue}var r=o[t];if(r&&!r.isAvailable()){console.log("Knockback configure: could not enable orm "+t+". Make sure it is included before Knockback");continue}n.settings.orm=r}else n.settings.orm=t;break;default:n.settings[a]=t}}}},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),a=o._,s=o.ko;e.exports=function(){function e(t){n(this,e),this.create_options=t,this._vo=s.observable(null)}return i(e,[{key:"destroy",value:function(){var e=void 0;return this.__kb_released=!0,(e=this.__kb_value)&&(this.__kb_value=null,this.create_options.store&&o.utils.wrappedCreator(e)?this.create_options.store.release(e):o.release(e)),this.create_options=null}},{key:"value",value:function(){return s.utils.unwrapObservable(this._vo())}},{key:"rawValue",value:function(){return this.__kb_value}},{key:"valueType",value:function(e,t){var r=o.getValue(e,t);return this.value_type||this._updateValueObservable(r),this.value_type}},{key:"update",value:function(e){if(!this.__kb_released){void 0!==e||(e=null);var t=o.utils.valueType(e);(null!=this.__kb_value?this.__kb_value.__kb_released:void 0)&&(this.__kb_value=this.value_type=void 0);var r=this.__kb_value;switch(this.value_type){case o.TYPE_COLLECTION:if(this.value_type===o.TYPE_COLLECTION&&t===o.TYPE_ARRAY)return r(e);if(t===o.TYPE_COLLECTION||a.isNull(e))return void(e&&e instanceof o.CollectionObservable?this._updateValueObservable(o.utils.wrappedObject(e),e):o.peek(r.collection)!==e&&r.collection(e));break;case o.TYPE_MODEL:if(t===o.TYPE_MODEL||a.isNull(e))return void(e&&!o.isModel(e)?this._updateValueObservable(o.utils.wrappedObject(e),e):o.utils.wrappedObject(r)!==o.utils.resolveModel(e)&&this._updateValueObservable(e))}if(this.value_type!==t||a.isUndefined(this.value_type)){if(o.peek(r)!==e)return this._updateValueObservable(e)}else if(o.peek(r)!==e)return r(e)}}},{key:"_updateValueObservable",value:function(e,t){var r=void 0,n=void 0,i=this.create_options,l=o.utils.inferCreator(e,i.factory,i.path);null!==e||l||(this.value_type===o.TYPE_MODEL?l=o.ViewModel:this.value_type===o.TYPE_COLLECTION&&(l=o.CollectionObservable)),i.creator=l;var u=o.TYPE_UNKNOWN,c=[this.__kb_value,void 0];return r=c[0],this.__kb_value=c[1],t?(n=t,i.store&&i.store.retain(t,e,l)):l?i.store?n=i.store.retainOrCreate(e,i,!0):l.models_only?(n=e,u=o.TYPE_SIMPLE):n=l.create?l.create(e,i):new l(e,i):a.isArray(e)?(u=o.TYPE_ARRAY,n=s.observableArray(e)):(u=o.TYPE_SIMPLE,n=s.observable(e)),(this.value_type=u)===o.TYPE_UNKNOWN&&(s.isObservable(n)?n.__kb_is_co?(this.value_type=o.TYPE_COLLECTION,o.utils.wrappedObject(n,e)):this.value_type||(this.value_type=o.TYPE_SIMPLE):(this.value_type=o.TYPE_MODEL,o.utils.wrappedObject(n,o.utils.resolveModel(e)))),r&&(this.create_options.store?this.create_options.store.release(r):o.release(r)),this.__kb_value=n,this._vo(n)}},{key:"_inferType",value:function(e){}}]),e}()},function(e,t,r){"use strict";var n,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"==typeof window?"undefined":i(window))&&(n=window)}e.exports=n},function(e,t,r){"use strict";function n(e,t,r){var n;return n=t&&o.has(t,"constructor")?t.constructor:function(){return e.apply(this,arguments)},i.assign(n,e,r),n.prototype=o.create(e.prototype,t),n.prototype.constructor=n,n.__super__=e.prototype,n}var i=r(0),o=i._;e.exports=function(e,t){var r=n(this,e,t);return r.extend=this.extend,r}},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){return void 0!==e&&null!==e?t(e):void 0}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(0),s=a._,l=a.ko,u=r(4),c=["destroy","shareOptions","filters","comparator","sortAttribute","viewModelByModel","hasViewModels"];a.compare=function(e,t){return s.isString(e)?e.localeCompare(""+t):s.isString(t)?t.localeCompare(""+e):e===t?0:e<t?-1:1};var f=function(){function e(t,r,i){var o=this;n(this,e),d.call(this);var u=Array.prototype.slice.call(s.isArguments(t)?t:arguments);return a.ignore(function(){t=u[0]instanceof a.Collection?u.shift():s.isArray(u[0])?new a.Collection(u.shift()):new a.Collection,s.isFunction(u[0])&&(u[0]={view_model:u[0]}),i={},s.each(u,function(e){return a.assign(i,e)});var e=a.utils.wrappedObservable(o,l.observableArray([]));e.__kb_is_co=!0,o.in_edit=0,o.__kb||(o.__kb={}),i=a.utils.collapseOptions(i),i.auto_compact&&(o.auto_compact=!0),i.sort_attribute?o._comparator=l.observable(o._attributeComparator(i.sort_attribute)):o._comparator=l.observable(i.comparator),i.filters?o._filters=l.observableArray(s.isArray(i.filters)?i.filters:[i.filters]):o._filters=l.observableArray([]),o.create_options={store:a.Store.useOptionsOrCreate(i,t,e)};var r=o.create_options;return a.utils.wrappedObject(e,t),o.path=i.path,r.factory=a.utils.wrappedFactory(e,o._shareOrCreateFactory(i)),r.path=a.utils.pathJoin(i.path,"models"),r.creator=r.factory.creatorForPath(null,r.path),r.creator&&(o.models_only=r.creator.models_only),a.publishMethods(e,o,c),o._collection=l.observable(t),e.collection=o.collection=l.computed({read:function(){return o._collection()},write:function(t){return a.ignore(function(){var r=void 0;if((r=o._collection())!==t)return a.utils.wrappedObject(e,t),r&&r.unbind("all",o._onCollectionChange),t&&t.bind("all",o._onCollectionChange),o._collection(t)})}}),t&&t.bind("all",o._onCollectionChange),o._mapper=l.computed(function(){var t=void 0,r=void 0,n=o._comparator(),i=o._filters();i&&function(){i.map(function(e){return l.utils.unwrapObservable(e)})}();var u=o._collection();if(!o.in_edit){e=a.utils.wrappedObservable(o);a.peek(e);u&&(t=u.models),t&&0!==u.models.length?(t=s.filter(t,function(e){return!i.length||o._selectModel(e)}),r=n?s.map(t,function(e){return o._createViewModel(e)}).sort(n):o.models_only?i.length?t:t.slice():s.map(t,function(e){return o._createViewModel(e)})):r=[],o.in_edit++,e(r),o.in_edit--}}),e.subscribe(s.bind(o._onObservableArrayChange,o)),!a.statistics||a.statistics.register("CollectionObservable",o),e})}return o(e,null,[{key:"initClass",value:function(){e.extend=u}}]),o(e,[{key:"destroy",value:function(){this.__kb_released=!0;var e=a.utils.wrappedObservable(this),t=a.peek(this._collection);if(a.utils.wrappedObject(e,null),t){t.unbind("all",this._onCollectionChange);var r=a.peek(e);r.splice(0,r.length)}return this.collection.dispose(),this._collection=e.collection=this.collection=null,this._mapper.dispose(),this._mapper=null,a.release(this._filters),this._filters=null,this._comparator(null),this._comparator=null,this.create_options=null,e.collection=null,a.utils.wrappedDestroy(this),!a.statistics||a.statistics.unregister("CollectionObservable",this)}},{key:"shareOptions",value:function(){var e=a.utils.wrappedObservable(this);return{store:a.utils.wrappedStore(e),factory:a.utils.wrappedFactory(e)}}},{key:"filters",value:function(e){return e?this._filters(s.isArray(e)?e:[e]):this._filters([])}},{key:"comparator",value:function(e){return this._comparator(e)}},{key:"sortAttribute",value:function(e){return this._comparator(e?this._attributeComparator(e):null)}},{key:"viewModelByModel",value:function(e){if(this.models_only)return null;var t=e.hasOwnProperty(e.idAttribute)?e.idAttribute:"cid";return s.find(a.peek(a.utils.wrappedObservable(this)),function(r){return!!i(null!=r?r.__kb:void 0,function(e){return e.object})&&r.__kb.object[t]===e[t]})}},{key:"hasViewModels",value:function(){return!this.models_only}},{key:"compact",value:function(){var e=this;return a.ignore(function(){var t=a.utils.wrappedObservable(e);if(a.utils.wrappedStoreIsOwned(t))return a.utils.wrappedStore(t).clear(),e._collection.notifySubscribers(e._collection())})}},{key:"_shareOrCreateFactory",value:function(e){var t=void 0,r=a.utils.pathJoin(e.path,"models"),n=e.factories;if(t=e.factory){var i=t.creatorForPath(null,r);if(i&&(!n||n.models===i)){if(!n)return t;if(t.hasPathMappings(n,e.path))return t}}return t=new a.Factory(e.factory),n&&t.addPathMappings(n,e.path),t.creatorForPath(null,r)||(e.hasOwnProperty("models_only")?e.models_only?t.addPathMapping(r,{models_only:!0}):t.addPathMapping(r,a.ViewModel):e.view_model?t.addPathMapping(r,e.view_model):e.create?t.addPathMapping(r,{create:e.create}):t.addPathMapping(r,a.ViewModel)),t}},{key:"_onModelRemove",value:function(e){var t=this.models_only?e:this.viewModelByModel(e);if(t){var r=a.utils.wrappedObservable(this);return this.in_edit++,r.remove(t),this.in_edit--}}},{key:"_attributeComparator",value:function(e){var t=function(t,r){var n=l.utils.unwrapObservable(e);return a.compare(t.get(n),r.get(n))};return this.models_only?t:function(e,r){return t(a.utils.wrappedModel(e),a.utils.wrappedModel(r))}}},{key:"_createViewModel",value:function(e){return this.models_only?e:this.create_options.store.retainOrCreate(e,this.create_options)}},{key:"_selectModel",value:function(e){for(var t=a.peek(this._filters),r=0,n=t.length;r<n;r++){var i=t[r];if(i=a.peek(i),s.isFunction(i)){if(!i(e))return!1}else if(s.isArray(i)){if(!i.includes(e.id))return!1}else if(e.id!==i)return!1}return!0}}]),e}(),d=function(){var e=this;this._onCollectionChange=function(t,r){return a.ignore(function(){var n=void 0;if(!e.in_edit&&!a.wasReleased(e))switch(t){case"reset":e.auto_compact?e.compact():e._collection.notifySubscribers(e._collection());break;case"sort":case"resort":e._collection.notifySubscribers(e._collection());break;case"new":case"add":if(!e._selectModel(r))return;var i=a.utils.wrappedObservable(e),o=e._collection();if(o.indexOf(r)===-1)return;if(e.viewModelByModel(r))return;e.in_edit++,(n=e._comparator())?(i().push(e._createViewModel(r)),i.sort(n)):i.splice(o.indexOf(r),0,e._createViewModel(r)),e.in_edit--;break;case"remove":case"destroy":e._onModelRemove(r);break;case"change":if(!e._selectModel(r))return e._onModelRemove(r);if(!(e.models_only?r:e.viewModelByModel(r)))return e._onCollectionChange("add",r);if(!(n=e._comparator()))return;e.in_edit++,a.utils.wrappedObservable(e).sort(n),e.in_edit--}})},this._onObservableArrayChange=function(t){return a.ignore(function(){var r=void 0;if(!e.in_edit){e.models_only&&(!t.length||a.isModel(t[0]))||!e.models_only&&(!t.length||s.isObject(t[0])&&!a.isModel(t[0]))||a._throwUnexpected(e,"incorrect type passed");var n=a.utils.wrappedObservable(e),i=a.peek(e._collection),o=a.peek(e._filters).length;if(i){var l=t;e.models_only?r=s.filter(t,function(t){return!o||e._selectModel(t)}):(!o||(l=[]),r=[],s.each(t,function(t){var n=void 0,i=a.utils.wrappedObject(t);if(o){if(!e._selectModel(i))return;l.push(t)}(n=e.create_options.store.find(i,e.create_options.creator))&&(n.constructor===t.constructor||a._throwUnexpected(e,"replacing different type of view model")),e.create_options.store.retain(t,i,e.create_options.creator),r.push(i)})),e.in_edit++,t.length===l.length||n(l),s.isEqual(i.models,r)||i.reset(r),e.in_edit--}}})}};f.initClass(),a.CollectionObservable=f,e.exports=f,a.collectionObservable=function(e,t,r){return new a.CollectionObservable(arguments)},a.observableCollection=a.collectionObservable},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),a=o._,s=o.ko;o.EventWatcher=function(){function e(t,r,i){var s=this;n(this,e),this._onModelLoaded=function(e){s.ee=e;for(var t in s.__kb.callbacks){var r=s.__kb.callbacks[t];r.model&&r.model!==e&&s._unbindCallbacks(t,r,!0),r.model||(r.model=e,e.bind(t,r.fn)),a.each(r.list,function(t){t.unbind_fn||(t.unbind_fn=null!=o.settings.orm?o.settings.orm.bind(e,t.key,t.update,t.path):void 0),t.emitter&&t.emitter(e)})}},this._onModelUnloaded=function(e){if(s.ee===e){s.ee=null;for(var t in s.__kb.callbacks){var r=s.__kb.callbacks[t];s._unbindCallbacks(t,r)}}},this._unbindCallbacks=function(e,t,r){t.model&&(t.model.unbind(e,t.fn),t.model=null),a.each(t.list,function(e){e.unbind_fn&&(e.unbind_fn(),e.unbind_fn=null),!e.emitter||r||o.wasReleased(e.obj)||e.emitter(null)})},this.__kb||(this.__kb={}),this.__kb.callbacks={},this.ee=null,i&&this.registerCallbacks(r,i),t&&this.emitter(t)}return i(e,null,[{key:"useOptionsOrCreate",value:function(e,t,r,n){return e.event_watcher?(e.event_watcher.emitter()!==t&&e.event_watcher.model_ref!==t&&o._throwUnexpected(this,"emitter not matching"),o.utils.wrappedEventWatcher(r,e.event_watcher).registerCallbacks(r,n)):(o.utils.wrappedEventWatcherIsOwned(r,!0),o.utils.wrappedEventWatcher(r,new o.EventWatcher(t)).registerCallbacks(r,n))}}]),i(e,[{key:"destroy",value:function(){return this.emitter(null),this.__kb.callbacks=null,o.utils.wrappedDestroy(this)}},{key:"emitter",value:function(e){return 0===arguments.length||this.ee===e?this.ee:(this.model_ref&&(this.model_ref.unbind("loaded",this._onModelLoaded),this.model_ref.unbind("unloaded",this._onModelUnloaded),this.model_ref.release(),this.model_ref=null),o.Backbone&&o.Backbone.ModelRef&&e instanceof o.Backbone.ModelRef?(this.model_ref=e,this.model_ref.retain(),this.model_ref.bind("loaded",this._onModelLoaded),this.model_ref.bind("unloaded",this._onModelUnloaded),e=this.model_ref.model()||null):delete this.model_ref,this.ee!==e&&(e?this._onModelLoaded(e):this._onModelUnloaded(this.ee)),e)}},{key:"registerCallbacks",value:function(e,t){var r=this;e||o._throwMissing(this,"obj"),t||o._throwMissing(this,"callback_info");var n=t.event_selector?t.event_selector.split(" "):["change"],i=this.ee;return a.each(n,function(n){if(n){var l=r.__kb.callbacks[n];l||(l=r.__kb.callbacks[n]={model:null,list:[],fn:function(e){a.each(l.list,function(t){t.update&&(e&&t.key&&e.hasChanged&&!e.hasChanged(s.utils.unwrapObservable(t.key))||(!o.statistics||o.statistics.addModelEvent({name:n,model:e,key:t.key,path:t.path}),t.update()))})}});var u=a.defaults({obj:e},t);return l.list.push(u),i?r._onModelLoaded(i):void 0}}),this}},{key:"releaseCallbacks",value:function(e){var t=void 0;this.ee=null;for(var r in this.__kb.callbacks)t=this.__kb.callbacks[r],this._unbindCallbacks(r,t,o.wasReleased(e));return delete this.__kb.callbacks}}]),e}(),o.emitterObservable=function(e,t){return new o.EventWatcher(e,t)}},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0);o._;o.Factory=function(){function e(t){n(this,e),this.paths={},t&&(this.parent_factory=t)}return i(e,null,[{key:"useOptionsOrCreate",value:function(e,t,r){if(e.factory&&(!e.factories||e.factories&&e.factory.hasPathMappings(e.factories,r)))return o.utils.wrappedFactory(t,e.factory);var n=o.utils.wrappedFactory(t,new o.Factory(e.factory));return e.factories&&n.addPathMappings(e.factories,r),n}}]),i(e,[{key:"hasPath",value:function(e){return this.paths.hasOwnProperty(e)||(null!=this.parent_factory?this.parent_factory.hasPath(e):void 0)}},{key:"addPathMapping",value:function(e,t){return this.paths[e]=t}},{key:"addPathMappings",value:function(e,t){for(var r in e){var n=e[r];this.paths[o.utils.pathJoin(t,r)]=n}}},{key:"hasPathMappings",value:function(e,t){var r=!0;for(var n in e){var i=e[n],a=this.creatorForPath(null,o.utils.pathJoin(t,n));r&=a&&i===a}return r}},{key:"creatorForPath",value:function(e,t){var r=this.paths[t];return r?r.view_model?r.view_model:r:this.parent_factory?this.parent_factory.creatorForPath(e,t):null}}]),e}()},function(e,t,r){"use strict";var n=r(0);e.exports=n,n.configure=r(1),n.modules={underscore:n._,backbone:n.Parse||n.Backbone,knockout:n.ko}},function(e,t,r){"use strict";(function(e){function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=null!=i?i:e,o=r(0),a=o._,s=o.ko;o.RECUSIVE_AUTO_INJECT=!0,s.bindingHandlers.inject={init:function(e,t,r,n){return o.Inject.inject(s.utils.unwrapObservable(t()),n,e,t,r)}},o.Inject=function(){function e(){t(this,e)}return n(e,null,[{key:"inject",value:function e(t,r,n,i,s,l){var e=function(e){if(a.isFunction(e))r=new e(r,n,i,s),o.releaseOnNodeRemove(r,n);else{e.view_model&&(r=new e.view_model(r,n,i,s),o.releaseOnNodeRemove(r,n));for(var t in e){var u=e[t];if("view_model"!==t)if("create"===t)u(r,n,i,s);else if(a.isObject(u)&&!a.isFunction(u)){var c=l||u&&u.create?{}:r;r[t]=o.Inject.inject(u,c,n,i,s,!0)}else r[t]=u}}return r};return l?e(t):o.ignore(function(){return e(t)})}},{key:"injectViewModels",value:function(e){var t=[];return!e&&(null!=i?i.document:void 0)&&(e=i.document),function e(r){if(!r.__kb_injected){var n=void 0;r.attributes&&(n=a.find(r.attributes,function(e){return"kb-inject"===e.name}))&&(r.__kb_injected=!0,t.push({el:r,view_model:{},binding:n.value}))}a.each(r.childNodes,function(t){return e(t)})}(e),a.each(t,function(e){var t=void 0,r=void 0,n=void 0,i=void 0;if(n=e.binding){var a;n.search(/[:]/)<0||(n="{"+n+"}");var s=new Function("","return ( "+n+" )")();s||(s={}),!s.options||(a=s,i=a.options,delete s.options),i||(i={}),e.view_model=o.Inject.inject(s,e.view_model,e.el,null,null,!0),t=e.view_model.afterBinding||i.afterBinding,r=e.view_model.beforeBinding||i.beforeBinding}r&&r.call(e.view_model,e.view_model,e.el,i),o.applyBindings(e.view_model,e.el,i),t&&t.call(e.view_model,e.view_model,e.el,i)}),t}}]),e}();var l=s.applyBindings;if(s.applyBindings=function(e,t){if(!(o.RECUSIVE_AUTO_INJECT?o.injectViewModels(t):[]).length)return l.apply(this,arguments)},o.injectViewModels=o.Inject.injectViewModels,"undefined"!=typeof document&&null!==document){var u=void 0;(u=function(){return"complete"!==document.readyState?setTimeout(u,0):o.injectViewModels()})()}}).call(t,r(3))},function(e,t,r){"use strict";var n=r(0),i=n.ko;if(function(e,t){return void 0!==e&&null!==e?t(e):void 0}(null!=i.subscribable?i.subscribable.fn:void 0,function(e){return e.extend})){var o=i.subscribable.fn.extend;i.subscribable.fn.extend=function(){var e=o.apply(this,arguments);if(e!==this&&n.isReleaseable(this)){var t=e.dispose;e.dispose=function(){return null!=t&&t.apply(e,arguments),n.release(this)}.bind(this)}return e}}},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){return void 0!==e&&null!==e?t(e):void 0}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(0),s=a._,l=a.ko,u=r(2),c=["value","valueType","destroy"],f=["args","read","write"];a.Observable=function(){function e(t,r,o,d){var _=this;return n(this,e),null==d&&(d={}),this._vm=d,a.ignore(function(){var e=void 0,n=void 0;r||a._throwMissing(_,"key_or_info"),_.key=r.key||r,s.map(f,function(e){r[e]&&(_[e]=r[e])});var d=a.utils.collapseOptions(o),v=d.event_watcher;delete d.event_watcher,_._value=new u(d),_._model=l.observable();var p=a.utils.wrappedObservable(_,l.computed({read:function(){return e=_._model(),n=[_.key].concat(_.args||[]),s.each(n,function(e){return l.utils.unwrapObservable(e)}),i(a.utils.wrappedEventWatcher(_),function(t){return t.emitter(e||null)}),_.read?_.update(_.read.apply(_._vm,n)):s.isUndefined(e)||a.ignore(function(){return _.update(a.getValue(e,a.peek(_.key),_.args))}),_._value.value()},write:function(t){return a.ignore(function(){var r=a.utils.unwrapModels(t);return e=a.peek(_._model),_.write?(_.write.call(_._vm,r),t=a.getValue(e,a.peek(_.key),_.args)):e&&a.setValue(e,a.peek(_.key),r),_.update(t)})},owner:_._vm}));return p.__kb_is_o=!0,d.store=a.utils.wrappedStore(p,d.store),d.path=a.utils.pathJoin(d.path,_.key),d.factories&&("function"==typeof d.factories||d.factories.create)?(d.factory=a.utils.wrappedFactory(p,new a.Factory(d.factory)),d.factory.addPathMapping(d.path,d.factories)):d.factory=a.Factory.useOptionsOrCreate(d,p,d.path),delete d.factories,a.publishMethods(p,_,c),p.model=_.model=l.computed({read:function(){return l.utils.unwrapObservable(_._model)},write:function(e){return a.ignore(function(){if(!_.__kb_released&&a.peek(_._model)!==e){var t=a.getValue(e,a.peek(_.key),_.args);return _._model(e),e?s.isUndefined(t)?void 0:_.update(t):_.update(null)}})}}),a.EventWatcher.useOptionsOrCreate({event_watcher:v},t||null,_,{emitter:_.model,update:function(){return a.ignore(function(){return _.update()})},key:_.key,path:d.path}),_._value.rawValue()||_._value.update(),a.LocalizedObservable&&r.localizer&&(p=new r.localizer(p)),a.DefaultObservable&&r.hasOwnProperty("default")&&(p=a.defaultObservable(p,r.default)),p})}return o(e,[{key:"destroy",value:function(){var e=a.utils.wrappedObservable(this);return this.__kb_released=!0,this._value.destroy(),this._value=null,this.model.dispose(),this.model=e.model=null,a.utils.wrappedDestroy(this)}},{key:"value",value:function(){return this._value.rawValue()}},{key:"valueType",value:function(){return this._value.valueType(a.peek(this._model),a.peek(this.key))}},{key:"update",value:function(e){if(!this.__kb_released)return arguments.length||(e=a.getValue(a.peek(this._model),a.peek(this.key))),this._value.update(e)}}]),e}(),a.observable=function(e,t,r,n){return new a.Observable(e,t,r,n)}},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),a=o._;e.exports=o.Statistics=function(){function e(){n(this,e),this.model_events_tracker=[],this.registered_tracker={}}return i(e,[{key:"clear",value:function(){return this.model_events_tracker=[]}},{key:"addModelEvent",value:function(e){return this.model_events_tracker.push(e)}},{key:"modelEventsStatsString",value:function(){var e="";e+="Total Count: "+this.model_events_tracker.length;var t=a.groupBy(this.model_events_tracker,function(e){return"event name: '"+e.name+"', attribute name: '"+e.key+"'"});for(var r in t){e+="\n "+r+", count: "+t[r].length}return e}},{key:"register",value:function(e,t){return this.registeredTracker(e).push(t)}},{key:"unregister",value:function(e,t){var r=this.registeredTracker(e),n=a.indexOf(r,t);return~n?r.splice(n,1):void("undefined"!=typeof console&&console.log("kb.Statistics: failed to unregister type: "+e))}},{key:"registeredCount",value:function(e){if(e)return this.registeredTracker(e).length;var t=0;for(e in this.registered_tracker[e]){t+=this.registered_tracker[e][e].length}return t}},{key:"registeredStatsString",value:function(e){var t="";for(var r in this.registered_tracker){var n=this.registered_tracker[r];if(n.length){i&&(t+="\n "),t+=(r||"No Name")+": "+n.length;var i=!0}}return t||e}},{key:"registeredTracker",value:function(e){if(this.registered_tracker.hasOwnProperty(e))return this.registered_tracker[e];var t=[];return this.registered_tracker[e]=t,t}}],[{key:"eventsStats",value:function(e,t){var r={count:0},n=e._events||e._callbacks||{},i=t?[t]:a.keys(n);return a.map(i,function(e){var t=n[e];if(t){if(a.isArray(t))r[e]=a.compact(t).length;else{r[e]=0;for(var i=t,o=i.tail;(t=t.next)!==o;)r[e]++}r.count+=r[e]}}),r}}]),e}()},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),a=o._,s=o.ko,l=function(){function e(){n(this,e),this.observable_records={},this.replaced_observables=[],o.Store.instances.push(this)}return i(e,null,[{key:"initClass",value:function(){e.instances=[]}},{key:"useOptionsOrCreate",value:function(e,t,r){e.store||o.utils.wrappedStoreIsOwned(r,!0);var n=o.utils.wrappedStore(r,e.store||new o.Store);return n.retain(r,t,e.creator),n}}]),i(e,[{key:"destroy",value:function(){this.__kb_released=!0,this.clear();var e=a.indexOf(o.Store.instances,this);if(~e)return o.Store.instances.splice(e,1)}},{key:"clear",value:function(){var e=this,t=void 0,r=void 0,n=void 0,i=[this.observable_records,{}];r=i[0],this.observable_records=i[1];for(var o in r){var s=r[o];for(var l in s)t=s[l],this.release(t,!0)}var u=[this.replaced_observables,[]];n=u[0],this.replaced_observables=u[1],a.each(n,function(t){t.__kb_released||e.release(t,!0)})}},{key:"compact",value:function(){for(var e in this.observable_records){var t=this.observable_records[e];for(var r in t)t[r].__kb_released&&delete t[r]}}},{key:"retain",value:function(e,t,r){var n=void 0;if(this._canRegister(e)){if(r||(r=e.constructor),n=this.find(t,r)){if(n===e)return this._getOrCreateStoreReferences(e).ref_count++,e;this._retire(n)}return this._add(e,t,r),this._getOrCreateStoreReferences(e).ref_count++,e}}},{
key:"retainOrCreate",value:function(e,t,r){var n=this,i=void 0,l=void 0;if(!(i=this._creator(e,t)))return o.utils.createFromDefaultCreator(e,t);if(i.models_only)return e;if(l=this.find(e,i))return r&&o.settings.deep_retain?this.retain(l,e,i):l;if(!a.isFunction(i.create||i))throw new Error('Invalid factory for "'+t.path+'"');return l=o.ignore(function(){return t=a.defaults({store:n,creator:i},t),(l=i.create?i.create(e,t):new i(e,t))||s.observable(null)}),this.retain(l,e,i),l}},{key:"reuse",value:function(e,t){var r=void 0,n=void 0;if((r=o.utils.wrappedObject(e))!==t){if(!this._canRegister(e))throw new Error("Cannot reuse a simple observable");if(1!==this._refCount(e))throw new Error("Trying to change a shared view model. Ref count: "+this._refCount(e));var i=o.utils.wrappedCreator(e)||e.constructor;a.isUndefined(r)||(n=this.find(r,i)),this.retain(e,t,i),n&&this.release(n)}}},{key:"release",value:function(e,t){var r=void 0;if(!this._canRegister(e))return o.release(e);if(r=this._storeReferences(e)){if(!t&&--r.ref_count>0)return;this._clearStoreReferences(e)}return this._remove(e),e.__kb_released?void 0:t||this._refCount(e)<=1?o.release(e):void 0}},{key:"find",value:function(e,t){var r=this.observable_records[this._creatorId(t)];if(!r)return null;var n=r[this._cid(e)];return n&&n.__kb_released?(delete r[this._cid(e)],null):n}},{key:"_refCount",value:function(e){var t=void 0;return e.__kb_released?("undefined"!=typeof console&&null!==console&&console.log("Observable already released"),0):(t=o.utils.get(e,"stores_references"))?a.reduce(t,function(e,t){return e+t.ref_count},0):1}},{key:"_canRegister",value:function(e){return e&&!s.isObservable(e)&&!e.__kb_is_co}},{key:"_cid",value:function(e){return e?e.cid||(e.cid=a.uniqueId("c")):"null"}},{key:"_creatorId",value:function(e){var t=e.create||e;t.__kb_cids||(t.__kb_cids=[]);for(var r=0,n=t.__kb_cids.length;r<n;r++){var i=t.__kb_cids[r];if(i.create===t)return i.cid}return t.__kb_cids.push(i={create:t,cid:a.uniqueId("kb")}),i.cid}},{key:"_storeReferences",value:function(e){var t=this,r=o.utils.get(e,"stores_references");if(r)return a.find(r,function(e){return e.store===t})}},{key:"_getOrCreateStoreReferences",value:function(e){var t=this,r=o.utils.orSet(e,"stores_references",[]),n=a.find(r,function(e){return e.store===t});return n||r.push(n={store:this,ref_count:0,release:function(){return t.release(e)}}),n}},{key:"_clearStoreReferences",value:function(e){if(o.utils.orSet(e,"stores_references",[]))for(var t=0,r=e.__kb.stores_references.length;t<r;t++){var n=e.__kb.stores_references[t];if(n.store===this){e.__kb.stores_references.splice(t,1);break}}}},{key:"_retire",value:function(e){return this._clearStoreReferences(e),this.replaced_observables.push(e),this._remove(e)}},{key:"_add",value:function(e,t,r){var n=void 0;return r||(r=e.constructor),o.utils.wrappedObject(e,t),o.utils.wrappedCreator(e,r),(this.observable_records[n=this._creatorId(r)]||(this.observable_records[n]={}))[this._cid(t)]=e}},{key:"_remove",value:function(e){var t=void 0,r=void 0,n=o.utils.wrappedCreator(e)||e.constructor;return(t=this.find(r=o.utils.wrappedObject(e),n))&&t===e&&delete this.observable_records[this._creatorId(n)][this._cid(r)],o.utils.wrappedObject(e,null),o.utils.wrappedCreator(e,null)}},{key:"_creator",value:function(e,t){var r=void 0;return t.creator?t.creator:(r=o.utils.inferCreator(e,t.factory,t.path))?r:o.isModel(e)?o.ViewModel:void 0}}]),e}();l.initClass(),o.Store=l,e.exports=l},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),a=o._,s=o.ko,l=function(){function e(){n(this,e)}return i(e,null,[{key:"initClass",value:function(){this.wrappedDestroy=r(18),this.collapseOptions=r(16),this.unwrapModels=r(17)}},{key:"get",value:function(e,t,r){return e.__kb&&e.__kb.hasOwnProperty(t)?e.__kb[t]:r}},{key:"set",value:function(e,t,r){return(e.__kb||(e.__kb={}))[t]=r}},{key:"orSet",value:function(e,t,r){return e.__kb||(e.__kb={}),e.__kb.hasOwnProperty(t)||(e.__kb[t]=r),e.__kb[t]}},{key:"has",value:function(e,t){return e.__kb&&e.__kb.hasOwnProperty(t)}},{key:"wrappedObservable",value:function(e,t){return 1===arguments.length?o.utils.get(e,"observable"):o.utils.set(e,"observable",t)}},{key:"wrappedObject",value:function(e,t){return 1===arguments.length?o.utils.get(e,"object"):o.utils.set(e,"object",t)}},{key:"wrappedCreator",value:function(e,t){return 1===arguments.length?o.utils.get(e,"creator"):o.utils.set(e,"creator",t)}},{key:"wrappedModel",value:function(e,t){return 1!==arguments.length?o.utils.set(e,"object",t):(t=o.utils.get(e,"object"),a.isUndefined(t)?e:t)}},{key:"wrappedStore",value:function(e,t){return 1===arguments.length?o.utils.get(e,"store"):o.utils.set(e,"store",t)}},{key:"wrappedStoreIsOwned",value:function(e,t){return 1===arguments.length?o.utils.get(e,"store_is_owned"):o.utils.set(e,"store_is_owned",t)}},{key:"wrappedFactory",value:function(e,t){return 1===arguments.length?o.utils.get(e,"factory"):o.utils.set(e,"factory",t)}},{key:"wrappedEventWatcher",value:function(e,t){return 1===arguments.length?o.utils.get(e,"event_watcher"):o.utils.set(e,"event_watcher",t)}},{key:"wrappedEventWatcherIsOwned",value:function(e,t){return 1===arguments.length?o.utils.get(e,"event_watcher_is_owned"):o.utils.set(e,"event_watcher_is_owned",t)}},{key:"valueType",value:function(e){return e?e.__kb_is_o?e.valueType():e.__kb_is_co||e instanceof o.Collection?o.TYPE_COLLECTION:e instanceof o.ViewModel||e instanceof o.Model?o.TYPE_MODEL:a.isArray(e)?o.TYPE_ARRAY:o.TYPE_SIMPLE:o.TYPE_UNKNOWN}},{key:"pathJoin",value:function(e,t){return(e?"."!==e[e.length-1]?e+".":e:"")+t}},{key:"optionsPathJoin",value:function(e,t){return a.defaults({path:this.pathJoin(e.path,t)},e)}},{key:"inferCreator",value:function(e,t,r){var n=t?t.creatorForPath(e,r):null;return n?n:e?e instanceof o.Model?o.ViewModel:e instanceof o.Collection?o.CollectionObservable:null:null}},{key:"createFromDefaultCreator",value:function(e,t){return o.isModel(e)?o.viewModel(e,t):o.isCollection(e)?o.collectionObservable(e,t):a.isArray(e)?s.observableArray(e):s.observable(e)}},{key:"resolveModel",value:function(e){return e&&o.Backbone&&o.Backbone.ModelRef&&e instanceof o.Backbone.ModelRef?e.model():e}}]),e}();l.initClass(),o.utils=l},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,r){if(void 0!==e&&null!==e&&"function"==typeof e[t])return r(e,t)}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(0),s=a._,l=a.ko,u=r(4),c=function(e,t){var r=e.__kb.internals&&~s.indexOf(e.__kb.internals,t)?"_"+t:t;if(!e.__kb.view_model.hasOwnProperty(r))return e.__kb.view_model[r]=null,r},f=function(e,t,r,n){var i=void 0;if((!e.__kb.excludes||!~s.indexOf(e.__kb.excludes,r))&&(!e.__kb.statics||!~s.indexOf(e.__kb.statics,r))&&(i=c(e,r)))return e[i]=e.__kb.view_model[i]=a.observable(t,r,n,e)},d=function(e,t){s.each(e.__kb.statics,function(r){var n=void 0;(n=c(e,r))&&(t.has(n)?e[n]=e.__kb.view_model[n]=t.get(n):e.__kb.static_defaults&&n in e.__kb.static_defaults?e[n]=e.__kb.view_model[n]=e.__kb.static_defaults[n]:delete e.__kb.view_model[n])})},_=["keys","internals","excludes","statics","static_defaults"],v=function(){function e(t){var r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};arguments[2];n(this,e);var o=Array.prototype.slice.call(s.isArguments(t)?t:arguments);return a.ignore(function(){!(t=o.shift())||a.isModel(t)||a._throwUnexpected(r,"not a model"),s.isArray(o[0])&&(o[0]={keys:o[0]}),r.__kb||(r.__kb={}),r.__kb.view_model=o.length>1?o.pop():r,i={},s.each(o,function(e){a.assign(i,e),i=a.utils.collapseOptions(i)}),s.each(_,function(e){i.hasOwnProperty(e)&&(r.__kb[e]=i[e])}),a.Store.useOptionsOrCreate(i,t,r),r.__kb.path=i.path,a.Factory.useOptionsOrCreate(i,r,i.path);var e=a.utils.set(r,"_model",l.observable());r.model=l.computed({read:function(){return l.utils.unwrapObservable(e)},write:function(t){return a.ignore(function(){if(a.utils.wrappedObject(r)!==t&&!a.wasReleased(r)&&n)return r.__kb.store.reuse(r,a.utils.resolveModel(t)),n.emitter(t),e(n.ee),!n.ee||r.createObservables(n.ee)})}});var n=a.utils.wrappedEventWatcher(r,new a.EventWatcher(t,r,{emitter:r._model,update:function(){return a.ignore(function(){return!(null!=n?n.ee:void 0)||r.createObservables(null!=n?n.ee:void 0)})}}));return a.utils.wrappedObject(r,t=n.ee),e(n.ee),r.__kb.create_options={store:a.utils.wrappedStore(r),factory:a.utils.wrappedFactory(r),path:r.__kb.path,event_watcher:a.utils.wrappedEventWatcher(r)},!i.requires||r.createObservables(t,i.requires),!r.__kb.internals||r.createObservables(t,r.__kb.internals),!i.mappings||r.createObservables(t,i.mappings),!r.__kb.statics||d(r,t),r.createObservables(t,r.__kb.keys),!a.statistics||a.statistics.register("ViewModel",r),r})}return o(e,null,[{key:"initClass",value:function(){e.extend=u}}]),o(e,[{key:"destroy",value:function(){var e=this;return this.__kb_released=!0,this.__kb.view_model!==this&&function(){var t=[];for(var r in e.__kb.vm_keys)t.push(e.__kb.view_model[r]=null);t}(),this.__kb.view_model=this.__kb.create_options=null,a.releaseKeys(this),a.utils.wrappedDestroy(this),!a.statistics||a.statistics.unregister("ViewModel",this)}},{key:"shareOptions",value:function(){return{store:a.utils.wrappedStore(this),factory:a.utils.wrappedFactory(this)}}},{key:"createObservables",value:function(e,t){var r=this,n=void 0;if(t)if(s.isArray(t))s.map(t,function(t){return f(r,e,t,r.__kb.create_options)});else for(n in t){var o,l=t[n];(o=c(this,n))&&(s.isString(l)||l.key||(l.key=o),this[o]=this.__kb.view_model[o]=a.observable(e,l,this.__kb.create_options,this))}else{var u=void 0;if(this.__kb.keys||!e)return;for(n in e.attributes)f(this,e,n,this.__kb.create_options);(u=i(a.settings.orm,"keys",function(t){return t.keys(e)}))&&function(){u.map(function(t){return f(r,e,t,r.__kb.create_options)})}()}}}]),e}();v.initClass(),a.ViewModel=v,e.exports=v,a.viewModel=function(e,t,r){return new a.ViewModel(arguments)}},function(e,t,r){"use strict";var n=r(0),i=n._,o=function(e,t,r){return e[t]||(e[t]=[]),i.isArray(r)||(r=[r]),e[t]=e[t].length?i.union(e[t],r):r,e},a=function(e,t,r){return e[t]||(e[t]={}),n.assign(e[t],r)},s=function(e){var t={};return i.each(e,function(e){t[e]={key:e}}),t},l=function e(t,r){if(!r)return t;for(var n in r){var l=r[n];switch(n){case"internals":case"requires":case"excludes":case"statics":o(t,n,l);break;case"keys":i.isObject(l)&&!i.isArray(l)||i.isObject(t[n])&&!i.isArray(t[n])?(i.isObject(l)||(l=[l]),i.isArray(l)&&(l=s(l)),i.isArray(t[n])&&(t[n]=s(t[n])),a(t,n,l)):o(t,n,l);break;case"factories":i.isFunction(l)?t[n]=l:a(t,n,l);break;case"static_defaults":a(t,n,l);break;case"options":break;default:t[n]=l}}return e(t,r.options)};e.exports=function(e){return l({},e)}},function(e,t,r){"use strict";var n=void 0,i=r(0),o=i._;e.exports=n=function(e){if(!e)return e;if(e.__kb)return e.__kb.hasOwnProperty("object")?e.__kb.object:e;if(o.isArray(e))return o.map(e,function(e){return n(e)});if(o.isObject(e)&&e.constructor==={}.constructor){var t={};for(var r in e)t[r]=n(e[r]);return t}return e}},function(e,t,r){"use strict";var n=r(0),i=(n._,function e(t){if(t.__kb){t.__kb.event_watcher&&t.__kb.event_watcher.releaseCallbacks(t);var r=t.__kb;if(t.__kb=null,r.observable&&(r.observable.destroy=r.observable.release=null,e(r.observable),r.observable=null),r.factory=null,r.event_watcher_is_owned&&r.event_watcher.destroy(),r.event_watcher=null,r.store_is_owned&&r.store.destroy(),r.store=null,r.stores_references)for(var n=void 0;n=r.stores_references.pop();)n.store.__kb_released||n.store.release(t)}});e.exports=i},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),a=o._,s=o.Backbone,l=null;e.exports=function(){function e(){n(this,e)}return i(e,null,[{key:"isAvailable",value:function(){return!!(l=s?s.AssociatedModel:null)}},{key:"keys",value:function(e){return e instanceof l?a.map(e.relations,function(e){return e.key}):null}},{key:"relationType",value:function(e,t){if(!(e instanceof l))return null;var r=a.find(e.relations,function(e){return e.key===t});return r?"Many"===r.type?o.TYPE_COLLECTION:o.TYPE_MODEL:null}},{key:"useFunction",value:function(){return!1}}]),e}()},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),a=o._,s=o.Backbone,l=null;e.exports=function(){function e(){n(this,e)}return i(e,null,[{key:"isAvailable",value:function(){return!!(l=s?s.RelationalModel:null)}},{key:"relationType",value:function(e,t){if(!(e instanceof l))return null;var r=a.find(e.getRelations(),function(e){return e.key===t});return r?r.collectionType||a.isArray(r.keyContents)?o.TYPE_COLLECTION:o.TYPE_MODEL:null}},{key:"bind",value:function(e,t,r,n){var i=this.relationType(e,t);if(!i)return null;var s=function(e){return!o.statistics||o.statistics.addModelEvent({name:"update (relational)",model:e,key:t,path:n}),r()},l=o.Backbone.Relation.prototype.sanitizeOptions?["update","add","remove"]:["change","add","remove"];return i===o.TYPE_COLLECTION?a.each(l,function(r){return e.bind(r+":"+t,s)}):e.bind(l[0]+":"+t,s),function(){i===o.TYPE_COLLECTION?a.each(l,function(r){return e.unbind(r+":"+t,s)}):e.unbind(l[0]+":"+t,s)}}},{key:"useFunction",value:function(){return!1}}]),e}()},function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t,r){r(5),r(1),r(6),r(7),r(9),r(0),r(10),r(11),r(12),r(13),r(2),r(14),r(15),e.exports=r(8)}])});