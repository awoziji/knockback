/*
  knockback-core.js 1.2.2
  Copyright (c)  2011-2017 Kevin Malakoff.
  License: MIT (http://www.opensource.org/licenses/mit-license.php)
  Source: https://github.com/kmalakoff/knockback
  Dependencies: Knockout.js, Backbone.js, and Underscore.js (or LoDash.js).
  Optional dependencies: Backbone.ModelRef.js and BackboneORM.
*/
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("underscore"),require("knockout"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","knockout","backbone"],t):"object"==typeof exports?exports.kb=t(require("underscore"),require("knockout"),require("backbone")):e.kb=t(e._,e.ko,e.Backbone)}(this,function(e,t,r){return function(e){function t(a){if(r[a])return r[a].exports;var n=r[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,a){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=19)}([function(t,r){t.exports=e},function(e,t,r){"use strict";(function(e){function a(e){return e&&e.__esModule?e:{default:e}}function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),i=r(0),o=a(i),s=r(3),d=a(s),f=r(2),c=a(f),_="undefined"!=typeof window?window:void 0!==e?e:void 0,p=["release","destroy","dispose"],v=function(){function e(){l(this,e)}return u(e,null,[{key:"initClass",value:function(){e.VERSION="1.2.2",e.TYPE_UNKNOWN=0,e.TYPE_SIMPLE=1,e.TYPE_ARRAY=2,e.TYPE_MODEL=3,e.TYPE_COLLECTION=4,e.assign=o.default.assign||o.default.extend;var t=function(e,t,r){var a=null;return c.default.computed(function(){a=e.apply(t,r||[])}).dispose(),a};e.ignore=c.default.dependencyDetection&&c.default.dependencyDetection.ignore?c.default.dependencyDetection.ignore:t}},{key:"wasReleased",value:function(e){return!e||e.__kb_released}},{key:"isReleaseable",value:function(t,r){if(null==r&&(r=0),!t||t!==Object(t)||t.__kb_released)return!1;if(c.default.isObservable(t)||t instanceof e.ViewModel)return!0;if("function"==typeof t||e.isModel(t)||e.isCollection(t))return!1;for(var a=0,n=p.length;a<n;a++){if("function"==typeof t[p[a]])return!0}if(r>0)return!1;for(var l in t)if(Object.prototype.hasOwnProperty.call(t,l)){var u=t[l];if("__kb"!==l&&e.isReleaseable(u,r+1))return!0}return!1}},{key:"release",value:function(t){if(e.isReleaseable(t)){if(t.__kb_released=!0,o.default.isArray(t))return void o.default.each(t,function(r,a){e.isReleaseable(r)&&(t[a]=null,e.release(r))});var r=e.peek(t);if(c.default.isObservable(t)&&o.default.isArray(r))return t.__kb_is_co||t.__kb_is_o&&t.valueType()===e.TYPE_COLLECTION?void("function"==typeof t.destroy&&t.destroy()):(o.default.each(r,function(t,a){e.isReleaseable(t)&&(r[a]=null,e.release(t))}),void("function"==typeof t.dispose&&t.dispose()));for(var a=0,n=p.length;a<n;a++){var l=p[a];if("function"==typeof t[l])return void t[l].call(t)}c.default.isObservable(t)||this.releaseKeys(t)}}},{key:"releaseKeys",value:function(t){o.default.each(t,function(r,a){"__kb"!==a&&e.isReleaseable(r)&&(t[a]=null,e.release(r))})}},{key:"releaseOnNodeRemove",value:function(t,r){return t||e._throwUnexpected(this,"missing view model"),r||e._throwUnexpected(this,"missing node"),c.default.utils.domNodeDisposal.addDisposeCallback(r,function(){return e.release(t)})}},{key:"renderTemplate",value:function(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!_.document)return void("undefined"==typeof console||console.log("renderTemplate: document is undefined"));var n=_.document.createElement("div"),l=c.default.renderTemplate(t,r,a,n,"replaceChildren");if(1===n.childNodes.length)n=n.childNodes[0];else if(n.childNodes.length)for(var u=0,i=n.childNodes.length,o=i>=0;o?u<=i:u>=i;o?u++:u--)try{c.default.storedBindingContextForNode(n,c.default.contextFor(n.childNodes[u]));break}catch(e){}return e.releaseOnNodeRemove(r,n),l.dispose(),r.afterRender&&!a.afterRender&&r.afterRender(n),n}},{key:"applyBindings",value:function(t,r){if(!_.document)return void("undefined"==typeof console||console.log("renderTemplate: document is undefined"));if(r.length){var a=r;r=_.document.createElement("div"),o.default.each(a,function(e){return r.appendChild(e)})}return c.default.applyBindings(t,r),e.releaseOnNodeRemove(t,r),r}},{key:"getValue",value:function(t,r,a){if(t)return a?t.get.apply(t,n(o.default.map([r].concat(a),function(t){return e.peek(t)}))):t.get(r)}},{key:"setValue",value:function(e,t,r){var a=void 0;if(e)return(a={})[t]=r,e.set(a)}},{key:"_throwMissing",value:function(e,t){throw new Error((o.default.isString(e)?e:e.constructor.name)+": "+t+" is missing")}},{key:"_throwUnexpected",value:function(e,t){throw new Error((o.default.isString(e)?e:e.constructor.name)+": "+t+" is unexpected")}},{key:"publishMethods",value:function(t,r,a){o.default.each(a,function(a){t[a]=e._.bind(r[a],r)})}},{key:"peek",value:function(t){return c.default.isObservable(t)?t.peek?t.peek():e.ignore(function(){return t()}):t}},{key:"isModel",value:function(e){return e&&(e instanceof d.default.Model||"function"==typeof e.get&&"function"==typeof e.bind)}},{key:"isCollection",value:function(e){return e&&e instanceof d.default.Collection}}]),e}();t.default=v,v.initClass()}).call(t,r(5))},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.emitterObservable=void 0;var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),u=r(0),i=a(u),o=r(3),s=a(o),d=r(2),f=a(d),c=r(1),_=a(c),p=function(){function e(t,r,a){var l=this;n(this,e),this._onModelLoaded=function(e){l.ee=e,i.default.each(l.__kb.callbacks,function(t,r){t.model&&t.model!==e&&l._unbindCallbacks(r,t,!0),t.model||(t.model=e,e.bind(r,t.fn)),i.default.each(t.list,function(t){!t.unbind_fn&&_.default.settings.orm&&_.default.settings.orm.customBind&&(t.unbind_fn=_.default.settings.orm.customBind(e,t.key,t.update,t.path)),t.emitter&&t.emitter(e)})})},this._onModelUnloaded=function(e){l.ee===e&&(l.ee=null,i.default.each(l.__kb.callbacks,function(e,t){return l._unbindCallbacks(t,e)}))},this._unbindCallbacks=function(e,t,r){t.model&&(t.model.unbind(e,t.fn),t.model=null),i.default.each(t.list,function(e){e.unbind_fn&&(e.unbind_fn(),e.unbind_fn=null),!e.emitter||r||_.default.wasReleased(e.obj)||e.emitter(null)})},this.__kb||(this.__kb={}),this.__kb.callbacks={},this.ee=null,a&&this.registerCallbacks(r,a),t&&this.emitter(t)}return l(e,null,[{key:"useOptionsOrCreate",value:function(t,r,a,n){return t.event_watcher?(t.event_watcher.emitter()!==r&&t.event_watcher.model_ref!==r&&_.default._throwUnexpected(this,"emitter not matching"),_.default.utils.wrappedEventWatcher(a,t.event_watcher).registerCallbacks(a,n)):(_.default.utils.wrappedEventWatcherIsOwned(a,!0),_.default.utils.wrappedEventWatcher(a,new e(r)).registerCallbacks(a,n))}}]),l(e,[{key:"destroy",value:function(){return this.emitter(null),this.__kb.callbacks=null,_.default.utils.wrappedDestroy(this)}},{key:"emitter",value:function(e){return 0===arguments.length||this.ee===e?this.ee:(this.model_ref&&(this.model_ref.unbind("loaded",this._onModelLoaded),this.model_ref.unbind("unloaded",this._onModelUnloaded),this.model_ref.release(),this.model_ref=null),s.default&&s.default.ModelRef&&e instanceof s.default.ModelRef?(this.model_ref=e,this.model_ref.retain(),this.model_ref.bind("loaded",this._onModelLoaded),this.model_ref.bind("unloaded",this._onModelUnloaded),e=this.model_ref.model()||null):delete this.model_ref,this.ee!==e&&(e?this._onModelLoaded(e):this._onModelUnloaded(this.ee)),e)}},{key:"registerCallbacks",value:function(e,t){var r=this;e||_.default._throwMissing(this,"obj"),t||_.default._throwMissing(this,"callback_info");var a=t.event_selector?t.event_selector.split(" "):["change"],n=this.ee;return i.default.each(a,function(a){if(a){var l=r.__kb.callbacks[a];l||(r.__kb.callbacks[a]={model:null,list:[],fn:function(e){i.default.each(l.list,function(t){t.update&&(e&&t.key&&e.hasChanged&&!e.hasChanged(f.default.utils.unwrapObservable(t.key))||(_.default.statistics&&_.default.statistics.addModelEvent({name:a,model:e,key:t.key,path:t.path}),t.update()))})}},l=r.__kb.callbacks[a]);var u=i.default.defaults({obj:e},t);l.list.push(u),n&&r._onModelLoaded(n)}}),this}},{key:"releaseCallbacks",value:function(e){var t=this;return this.ee=null,i.default.each(this.__kb.callbacks,function(r,a){return t._unbindCallbacks(a,r,_.default.wasReleased(e))}),delete this.__kb.callbacks}}]),e}();t.default=p;t.emitterObservable=function(e,t){return new p(e,t)}},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.collectionObservable=t.compare=void 0;var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),u=r(0),i=a(u),o=r(3),s=a(o),d=r(2),f=a(d),c=r(1),_=a(c),p=["destroy","shareOptions","filters","comparator","sortAttribute","viewModelByModel","hasViewModels"],v=t.compare=function(e,t){return i.default.isString(e)?e.localeCompare(""+t):i.default.isString(t)?t.localeCompare(""+e):e===t?0:e<t?-1:1},b=function(){function e(){for(var t=this,r=arguments.length,a=Array(r),l=0;l<r;l++)a[l]=arguments[l];return n(this,e),this._onCollectionChange=function(e,r){return _.default.ignore(function(){if(!t.in_edit&&!_.default.wasReleased(t))switch(e){case"reset":t.auto_compact?t.compact():t._collection.notifySubscribers(t._collection());break;case"sort":case"resort":t._collection.notifySubscribers(t._collection());break;case"new":case"add":if(!t._selectModel(r))return;var a=_.default.utils.wrappedObservable(t),n=t._collection();if(!~n.indexOf(r))return;if(t.viewModelByModel(r))return;t.in_edit++;var l=t._comparator();if(l)a().push(t._createViewModel(r)),a.sort(l);else{var u=t._createViewModel(r);a.splice(n.indexOf(r),0,u)}t.in_edit--;break;case"remove":case"destroy":t._onModelRemove(r);break;case"change":if(!t._selectModel(r))return t._onModelRemove(r);if(!(t.models_only?r:t.viewModelByModel(r)))return t._onCollectionChange("add",r);var i=t._comparator();if(!i)return;t.in_edit++,_.default.utils.wrappedObservable(t).sort(i),t.in_edit--}})},this._onObservableArrayChange=function(e){return _.default.ignore(function(){if(!t.in_edit){t.models_only&&e.length&&!_.default.isModel(e[0])&&_.default._throwUnexpected(t,"incorrect type passed"),t.models_only||!e.length||i.default.isObject(e[0])||_.default.isModel(e[0])||_.default._throwUnexpected(t,"incorrect type passed");var r=_.default.utils.wrappedObservable(t),a=_.default.peek(t._collection),n=_.default.peek(t._filters).length;if(a){var l=e,u=void 0;t.models_only?u=i.default.filter(e,function(e){return!n||t._selectModel(e)}):(!n||(l=[]),u=[],i.default.each(e,function(e){var r=_.default.utils.wrappedObject(e);if(n){if(!t._selectModel(r))return;l.push(e)}var a=t.create_options.store.find(r,t.create_options.creator);a&&a.constructor!==e.constructor&&_.default._throwUnexpected(t,"replacing different type of view model"),t.create_options.store.retain(e,r,t.create_options.creator),u.push(r)})),t.in_edit++,e.length===l.length||r(l),i.default.isEqual(a.models,u)||a.reset(u),t.in_edit--}}})},_.default.ignore(function(){var e=null;e=_.default.isCollection(a[0])?a.shift():i.default.isArray(a[0])?new s.default.Collection(a.shift()):new s.default.Collection,i.default.isFunction(a[0])&&(a[0]={view_model:a[0]});var r={};i.default.each(a,function(e){_.default.assign(r,e),r=_.default.utils.collapseOptions(r)});var n=_.default.utils.wrappedObservable(t,f.default.observableArray([]));n.__kb_is_co=!0,t.in_edit=0,t.__kb||(t.__kb={}),r=_.default.utils.collapseOptions(r),r.auto_compact&&(t.auto_compact=!0),r.sort_attribute?t._comparator=f.default.observable(t._attributeComparator(r.sort_attribute)):t._comparator=f.default.observable(r.comparator),r.filters?t._filters=f.default.observableArray(i.default.isArray(r.filters)?r.filters:[r.filters]):t._filters=f.default.observableArray([]),t.create_options={store:_.default.Store.useOptionsOrCreate(r,e,n)};var l=t.create_options;return _.default.utils.wrappedObject(n,e),t.path=r.path,l.factory=_.default.utils.wrappedFactory(n,t._shareOrCreateFactory(r)),l.path=_.default.utils.pathJoin(r.path,"models"),l.creator=l.factory.creatorForPath(null,l.path),l.creator&&(t.models_only=l.creator.models_only),_.default.publishMethods(n,t,p),t._collection=f.default.observable(e),t.collection=f.default.computed({read:function(){return t._collection()},write:function(e){return _.default.ignore(function(){var r=t._collection();if(r!==e)return _.default.utils.wrappedObject(n,e),r&&r.unbind("all",t._onCollectionChange),e&&e.bind("all",t._onCollectionChange),t._collection(e)})}}),n.collection=t.collection,e&&e.bind("all",t._onCollectionChange),t._mapper=f.default.computed(function(){var e=t._comparator(),r=t._filters();r&&i.default.each(r,function(e){return f.default.utils.unwrapObservable(e)});var a=t._collection();if(!t.in_edit){n=_.default.utils.wrappedObservable(t);var l=void 0;a&&(l=a.models);var u=void 0;l&&0!==a.models.length?(l=i.default.filter(l,function(e){return!r.length||t._selectModel(e)}),u=e?i.default.map(l,function(e){return t._createViewModel(e)}).sort(e):t.models_only?r.length?l:l.slice():i.default.map(l,function(e){return t._createViewModel(e)})):u=[],t.in_edit++,n(u),t.in_edit--}}),n.subscribe(i.default.bind(t._onObservableArrayChange,t)),_.default.statistics&&_.default.statistics.register("CollectionObservable",t),n})}return l(e,null,[{key:"initClass",value:function(){e.extend=s.default.Model.extend}}]),l(e,[{key:"destroy",value:function(){this.__kb_released=!0;var e=_.default.utils.wrappedObservable(this),t=_.default.peek(this._collection);if(_.default.utils.wrappedObject(e,null),t){t.unbind("all",this._onCollectionChange);var r=_.default.peek(e);r.splice(0,r.length)}this.collection.dispose(),this.collection=null,this._collection=null,e.collection=null,this._mapper.dispose(),this._mapper=null,_.default.release(this._filters),this._filters=null,this._comparator(null),this._comparator=null,this.create_options=null,e.collection=null,_.default.utils.wrappedDestroy(this),_.default.statistics&&_.default.statistics.unregister("CollectionObservable",this)}},{key:"shareOptions",value:function(){var e=_.default.utils.wrappedObservable(this);return{store:_.default.utils.wrappedStore(e),factory:_.default.utils.wrappedFactory(e)}}},{key:"filters",value:function(e){return e?this._filters(i.default.isArray(e)?e:[e]):this._filters([])}},{key:"comparator",value:function(e){return this._comparator(e)}},{key:"sortAttribute",value:function(e){return this._comparator(e?this._attributeComparator(e):null)}},{key:"viewModelByModel",value:function(e){if(this.models_only)return null;var t=Object.prototype.hasOwnProperty.call(e,e.idAttribute)?e.idAttribute:"cid";return i.default.find(_.default.peek(_.default.utils.wrappedObservable(this)),function(r){return r&&r.__kb&&r.__kb.object[t]===e[t]})}},{key:"hasViewModels",value:function(){return!this.models_only}},{key:"compact",value:function(){var e=this;return _.default.ignore(function(){var t=_.default.utils.wrappedObservable(e);if(_.default.utils.wrappedStoreIsOwned(t))return _.default.utils.wrappedStore(t).clear(),e._collection.notifySubscribers(e._collection())})}},{key:"_shareOrCreateFactory",value:function(e){var t=_.default.utils.pathJoin(e.path,"models"),r=e.factories,a=e.factory;if(a){var n=a.creatorForPath(null,t);if(n&&(!r||r.models===n)){if(!r)return a;if(a.hasPathMappings(r,e.path))return a}}return a=new _.default.Factory(e.factory),r&&a.addPathMappings(r,e.path),a.creatorForPath(null,t)||(Object.prototype.hasOwnProperty.call(e,"models_only")?e.models_only?a.addPathMapping(t,{models_only:!0}):a.addPathMapping(t,_.default.ViewModel):e.view_model?a.addPathMapping(t,e.view_model):e.create?a.addPathMapping(t,{create:e.create}):a.addPathMapping(t,_.default.ViewModel)),a}},{key:"_onModelRemove",value:function(e){var t=this.models_only?e:this.viewModelByModel(e);if(t){var r=_.default.utils.wrappedObservable(this);return this.in_edit++,r.remove(t),this.in_edit--}}},{key:"_attributeComparator",value:function(e){var t=function(t,r){var a=f.default.utils.unwrapObservable(e);return v(t.get(a),r.get(a))};return this.models_only?t:function(e,r){return t(_.default.utils.wrappedModel(e),_.default.utils.wrappedModel(r))}}},{key:"_createViewModel",value:function(e){return this.models_only?e:this.create_options.store.retainOrCreate(e,this.create_options)}},{key:"_selectModel",value:function(e){for(var t=_.default.peek(this._filters),r=0,a=t.length;r<a;r++){var n=t[r];if(n=_.default.peek(n),i.default.isFunction(n)){if(!n(e))return!1}else if(i.default.isArray(n)){if(!~n.indexOf(e.id))return!1}else if(e.id!==n)return!1}return!0}}]),e}();t.default=b,b.initClass();t.collectionObservable=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return new(Function.prototype.bind.apply(b,[null].concat(t)))}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.configure=t.settings=void 0;var n=r(0),l=a(n),u=r(21),i=a(u),o=r(22),s=a(o),d={default:null,"backbone-orm":null,"backbone-associations":i.default,"backbone-relational":s.default},f=t.settings={orm:d.default};for(var c in d)if(Object.prototype.hasOwnProperty.call(d,c)){var _=d[c];if(_&&_.isAvailable()){f.orm=_;break}}t.configure=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l.default.each(e,function(e,t){switch(t){case"orm":if(l.default.isString(e)){if(!Object.prototype.hasOwnProperty.call(d,e))return void("undefined"==typeof console||console.log("Knockback configure: could not find orm: "+e+". Available: "+l.default.keys(d).join(", ")));var r=d[e];if(r&&!r.isAvailable())return void("undefined"==typeof console||console.log("Knockback configure: could not enable orm "+e+". Make sure it is included before Knockback"));f.orm=r}else f.orm=e;break;default:f[t]=e}})}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),u=r(0),i=a(u),o=r(1),s=a(o),d=function(){function e(t){n(this,e),this.paths={},t&&(this.parent_factory=t)}return l(e,null,[{key:"useOptionsOrCreate",value:function(e,t,r){if(e.factory&&(!e.factories||e.factories&&e.factory.hasPathMappings(e.factories,r)))return s.default.utils.wrappedFactory(t,e.factory);var a=s.default.utils.wrappedFactory(t,new s.default.Factory(e.factory));return e.factories&&a.addPathMappings(e.factories,r),a}}]),l(e,[{key:"hasPath",value:function(e){return!(!Object.prototype.hasOwnProperty.call(this.paths,e)||!this.parent_factory)&&this.parent_factory.hasPath(e)}},{key:"addPathMapping",value:function(e,t){this.paths[e]=t}},{key:"addPathMappings",value:function(e,t){var r=this;i.default.each(e,function(e,a){r.paths[s.default.utils.pathJoin(t,a)]=e})}},{key:"hasPathMappings",value:function(e,t){var r=!0;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var n=e[a],l=this.creatorForPath(null,s.default.utils.pathJoin(t,a));r&=l&&n===l}return r}},{key:"creatorForPath",value:function(e,t){var r=this.paths[t];return r?r.view_model?r.view_model:r:this.parent_factory?this.parent_factory.creatorForPath(e,t):null}}]),e}();t.default=d},function(e,t,r){"use strict";(function(e){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.injectViewModels=t.RECUSIVE_AUTO_INJECT=void 0;var n=r(0),l=a(n),u=r(2),i=a(u),o="undefined"!=typeof window?window:void 0!==e?e:void 0,s=(t.RECUSIVE_AUTO_INJECT=!0,function(e,t,r,a,n,u){var i=function(e){return l.default.isFunction(e)?(t=new e(t,r,a,n),kb.releaseOnNodeRemove(t,r)):(e.view_model&&(t=new e.view_model(t,r,a,n),kb.releaseOnNodeRemove(t,r)),l.default.each(e,function(e,i){if("view_model"!==i)if("create"===i)e(t,r,a,n);else if(l.default.isObject(e)&&!l.default.isFunction(e)){var o=u||e&&e.create?{}:t;t[i]=kb.Inject.inject(e,o,r,a,n,!0)}else t[i]=e})),t};return u?i(e):kb.ignore(function(){return i(e)})});i.default.bindingHandlers.inject={init:function(e,t,r,a){return s(i.default.utils.unwrapObservable(t()),a,e,t,r)}};var d=function(e){var t={},r=null,a=null,n=e.binding;if(n){!~n.search(/[:]/)||(n="{"+n+"}");var l=new Function("","return ( "+n+" )")()||{};l.options&&(t=l.options,delete l.options),e.view_model=s(l,e.view_model,e.el,null,null,!0),r=e.view_model.afterBinding||t.afterBinding,a=e.view_model.beforeBinding||t.beforeBinding}a&&a.call(e.view_model,e.view_model,e.el,t),kb.applyBindings(e.view_model,e.el,t),r&&r.call(e.view_model,e.view_model,e.el,t)},f=t.injectViewModels=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.document,r=[];if(!t.__kb_injected){var a=l.default.find(t.attributes||[],function(e){return"kb-inject"===e.name});if(a){t.__kb_injected=!0;var n={el:t,view_model:{},binding:a.value};d(n),r.push(n)}}return l.default.each(t.childNodes,function(t){var a=e(t);a.length&&l.default.each(a,function(e){return r.push(e)})}),r},c=i.default.applyBindings;if(i.default.applyBindings=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=t[1],n=kb.RECUSIVE_AUTO_INJECT?f(a):[];return n.length?n:c.call.apply(c,[void 0].concat(t))},o&&void 0!==o.document){!function e(){return"complete"!==o.document.readyState?setTimeout(e,0):f()}()}}).call(t,r(5))},function(e,t,r){"use strict";var a=r(2),n=function(e){return e&&e.__esModule?e:{default:e}}(a);if(n.default.subscribable&&n.default.subscribable.fn&&n.default.subscribable.fn.extend){var l=n.default.subscribable.fn.extend;n.default.subscribable.fn.extend=function(){for(var e=this,t=arguments.length,r=Array(t),a=0;a<t;a++)r[a]=arguments[a];var n=l.apply(this,r);if(n!==this&&kb.isReleaseable(this)){var u=n.dispose;n.dispose=function(){for(var t=arguments.length,r=Array(t),a=0;a<t;a++)r[a]=arguments[a];return!u||u.apply(n,r),kb.release(e)}}return n}}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.observable=void 0;var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),u=r(0),i=a(u),o=r(2),s=a(o),d=r(1),f=a(d),c=r(20),_=a(c),p=r(4),v=a(p),b=["value","valueType","destroy"],h=["args","read","write"],y=function(){function e(t,r,a,l){var u=this;return n(this,e),null==l&&(l={}),this._vm=l,f.default.ignore(function(){r||f.default._throwMissing(u,"key_or_info"),u.key=r.key||r,i.default.map(h,function(e){r[e]&&(u[e]=r[e])});var e=f.default.utils.collapseOptions(a),n=e.event_watcher;delete e.event_watcher,u._value=new _.default(e),u._model=s.default.observable();var l=f.default.utils.wrappedObservable(u,s.default.computed({read:function(){var e=u._model(),t=[u.key].concat(u.args||[]);i.default.each(t,function(e){return s.default.utils.unwrapObservable(e)});var r=f.default.utils.wrappedEventWatcher(u);return!r||r.emitter(e||null),u.read?u.update(u.read.apply(u._vm,t)):i.default.isUndefined(e)||f.default.ignore(function(){return u.update(f.default.getValue(e,f.default.peek(u.key),u.args))}),u._value.value()},write:function(e){return f.default.ignore(function(){var t=f.default.utils.unwrapModels(e),r=f.default.peek(u._model);return u.write?(u.write.call(u._vm,t),e=f.default.getValue(r,f.default.peek(u.key),u.args)):r&&f.default.setValue(r,f.default.peek(u.key),t),u.update(e)})},owner:u._vm}));return l.__kb_is_o=!0,e.store=f.default.utils.wrappedStore(l,e.store),e.path=f.default.utils.pathJoin(e.path,u.key),e.factories&&("function"==typeof e.factories||e.factories.create)?(e.factory=f.default.utils.wrappedFactory(l,new f.default.Factory(e.factory)),e.factory.addPathMapping(e.path,e.factories)):e.factory=f.default.Factory.useOptionsOrCreate(e,l,e.path),delete e.factories,f.default.publishMethods(l,u,b),u.model=s.default.computed({read:function(){return s.default.utils.unwrapObservable(u._model)},write:function(e){return f.default.ignore(function(){if(!u.__kb_released&&f.default.peek(u._model)!==e){var t=f.default.getValue(e,f.default.peek(u.key),u.args);return u._model(e),e?i.default.isUndefined(t)?void 0:u.update(t):u.update(null)}})}}),l.model=u.model,v.default.useOptionsOrCreate({event_watcher:n},t||null,u,{emitter:u.model,update:function(){return f.default.ignore(function(){return u.update()})},key:u.key,path:e.path}),u._value.rawValue()||u._value.update(),f.default.LocalizedObservable&&r.localizer&&(l=new r.localizer(l)),f.default.DefaultObservable&&Object.prototype.hasOwnProperty.call(r,"default")&&(l=f.default.defaultObservable(l,r.default)),l})}return l(e,[{key:"destroy",value:function(){var e=f.default.utils.wrappedObservable(this);return this.__kb_released=!0,this._value.destroy(),this._value=null,this.model.dispose(),this.model=null,e.model=null,f.default.utils.wrappedDestroy(this)}},{key:"value",value:function(){return this._value.rawValue()}},{key:"valueType",value:function(){return this._value.valueType(f.default.peek(this._model),f.default.peek(this.key))}},{key:"update",value:function(e){if(!this.__kb_released)return arguments.length||(e=f.default.getValue(f.default.peek(this._model),f.default.peek(this.key))),this._value.update(e)}}]),e}();t.default=y;t.observable=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return new(Function.prototype.bind.apply(y,[null].concat(t)))}},function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),l=r(0),u=function(e){return e&&e.__esModule?e:{default:e}}(l),i=function(){function e(){a(this,e),this.model_events_tracker=[],this.registered_tracker={}}return n(e,[{key:"clear",value:function(){this.model_events_tracker=[]}},{key:"addModelEvent",value:function(e){this.model_events_tracker.push(e)}},{key:"modelEventsStatsString",value:function(){var e="";e+="Total Count: "+this.model_events_tracker.length;var t=u.default.groupBy(this.model_events_tracker,function(e){return"event name: '"+e.name+"', attribute name: '"+e.key+"'"});return u.default.each(t,function(t,r){e+="\n "+r+", count: "+t.length}),e}},{key:"register",value:function(e,t){this.registeredTracker(e).push(t)}},{key:"unregister",value:function(e,t){var r=this.registeredTracker(e),a=u.default.indexOf(r,t);return~a?r.splice(a,1):void("undefined"!=typeof console&&console.log("kb.Statistics: failed to unregister type: "+e))}},{key:"registeredCount",value:function(e){if(e)return this.registeredTracker(e).length;var t=0;return u.default.each(this.registered_tracker[e],function(e){t+=e.length}),t}},{key:"registeredStatsString",value:function(e){var t="",r=!1;return u.default.each(this.registered_tracker,function(e,a){e.length&&(r&&(t+="\n "),t+=(a||"No Name")+": "+e.length,r=!0)}),t||e}},{key:"registeredTracker",value:function(e){if(Object.prototype.hasOwnProperty.call(this.registered_tracker,e))return this.registered_tracker[e];var t=[];return this.registered_tracker[e]=t,t}}],[{key:"eventsStats",value:function(e,t){var r={count:0},a=e._events||e._callbacks||{},n=t?[t]:u.default.keys(a);return u.default.each(n,function(e){var t=a[e];if(t){if(u.default.isArray(t))r[e]=u.default.compact(t).length;else{var n=t,l=n.tail;for(r[e]=0,t=t.next;t!==l;)r[e]++,t=t.next}r.count+=r[e]}}),r}}]),e}();t.default=i},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),u=r(0),i=a(u),o=r(2),s=a(o),d=r(1),f=a(d),c=function(){function e(){n(this,e),this.observable_records={},this.replaced_observables=[],f.default.Store.instances.push(this)}return l(e,null,[{key:"initClass",value:function(){e.instances=[]}},{key:"useOptionsOrCreate",value:function(e,t,r){e.store||f.default.utils.wrappedStoreIsOwned(r,!0);var a=f.default.utils.wrappedStore(r,e.store||new f.default.Store);return a.retain(r,t,e.creator),a}}]),l(e,[{key:"destroy",value:function(){this.__kb_released=!0,this.clear();var e=i.default.indexOf(f.default.Store.instances,this);~e&&f.default.Store.instances.splice(e,1)}},{key:"clear",value:function(){var e=this,t=this.observable_records;this.observable_records={},i.default.each(t,function(t){i.default.each(t,function(t){return e.release(t,!0)})});var r=this.replaced_observables;this.replaced_observables=[],i.default.each(r,function(t){t.__kb_released||e.release(t,!0)})}},{key:"compact",value:function(){i.default.each(this.observable_records,function(e){i.default.each(e,function(t,r){t.__kb_released&&delete e[r]})})}},{key:"retain",value:function(e,t,r){if(this._canRegister(e)){r||(r=e.constructor);var a=this.find(t,r);if(a){if(a===e)return this._getOrCreateStoreReferences(e).ref_count++,e;this._retire(a)}return this._add(e,t,r),this._getOrCreateStoreReferences(e).ref_count++,e}}},{key:"retainOrCreate",value:function(e,t,r){var a=this,n=this._creator(e,t);if(!n)return f.default.utils.createFromDefaultCreator(e,t);if(n.models_only)return e;var l=this.find(e,n);if(l)return r&&f.default.settings.deep_retain?this.retain(l,e,n):l;if(!i.default.isFunction(n.create||n))throw new Error('Invalid factory for "'+t.path+'"');return l=f.default.ignore(function(){return t=i.default.defaults({store:a,creator:n},t),(l=n.create?n.create(e,t):new n(e,t))||s.default.observable(null)}),this.retain(l,e,n),l}},{key:"reuse",value:function(e,t){var r=f.default.utils.wrappedObject(e);if(r!==t){if(!this._canRegister(e))throw new Error("Cannot reuse a simple observable");if(1!==this._refCount(e))throw new Error("Trying to change a shared view model. Ref count: "+this._refCount(e));var a=f.default.utils.wrappedCreator(e)||e.constructor,n=void 0;i.default.isUndefined(r)||(n=this.find(r,a)),this.retain(e,t,a),n&&this.release(n)}}},{key:"release",value:function(e,t){
if(!this._canRegister(e))return f.default.release(e);var r=this._storeReferences(e);if(r){if(!t&&--r.ref_count>0)return;this._clearStoreReferences(e)}return this._remove(e),e.__kb_released?void 0:t||this._refCount(e)<=1?f.default.release(e):void 0}},{key:"find",value:function(e,t){var r=this.observable_records[this._creatorId(t)];if(!r)return null;var a=r[this._cid(e)];return a&&a.__kb_released?(delete r[this._cid(e)],null):a}},{key:"_refCount",value:function(e){if(e.__kb_released)return"undefined"==typeof console||console.log("Observable already released"),0;var t=f.default.utils.get(e,"stores_references");return t?i.default.reduce(t,function(e,t){return e+t.ref_count},0):1}},{key:"_canRegister",value:function(e){return e&&!s.default.isObservable(e)&&!e.__kb_is_co}},{key:"_cid",value:function(e){return e?(e.cid||(e.cid=i.default.uniqueId("c")),e.cid):"null"}},{key:"_creatorId",value:function(e){var t=e.create||e;t.__kb_cids||(t.__kb_cids=[]);for(var r=0,a=t.__kb_cids.length;r<a;r++){var n=t.__kb_cids[r];if(n.create===t)return n.cid}var l={create:t,cid:i.default.uniqueId("kb")};return t.__kb_cids.push(l),l.cid}},{key:"_storeReferences",value:function(e){var t=this,r=f.default.utils.get(e,"stores_references");if(r)return i.default.find(r,function(e){return e.store===t})}},{key:"_getOrCreateStoreReferences",value:function(e){var t=this,r=f.default.utils.orSet(e,"stores_references",[]),a=i.default.find(r,function(e){return e.store===t});return a||r.push(a={store:this,ref_count:0,release:function(){return t.release(e)}}),a}},{key:"_clearStoreReferences",value:function(e){if(f.default.utils.orSet(e,"stores_references",[]))for(var t=0,r=e.__kb.stores_references.length;t<r;t++){var a=e.__kb.stores_references[t];if(a.store===this){e.__kb.stores_references.splice(t,1);break}}}},{key:"_retire",value:function(e){return this._clearStoreReferences(e),this.replaced_observables.push(e),this._remove(e)}},{key:"_add",value:function(e,t,r){r||(r=e.constructor),f.default.utils.wrappedObject(e,t),f.default.utils.wrappedCreator(e,r);var a=this._creatorId(r);return this.observable_records[a]||(this.observable_records[a]={}),this.observable_records[a][this._cid(t)]=e,e}},{key:"_remove",value:function(e){var t=f.default.utils.wrappedCreator(e)||e.constructor,r=f.default.utils.wrappedObject(e),a=this.find(r,t);return a&&a===e&&delete this.observable_records[this._creatorId(t)][this._cid(r)],f.default.utils.wrappedObject(e,null),f.default.utils.wrappedCreator(e,null)}},{key:"_creator",value:function(e,t){if(t.creator)return t.creator;var r=f.default.utils.inferCreator(e,t.factory,t.path);return r?r:f.default.isModel(e)?f.default.ViewModel:void 0}}]),e}();t.default=c,c.initClass()},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),u=r(0),i=a(u),o=r(3),s=a(o),d=r(2),f=a(d),c=r(1),_=a(c),p=r(18),v=a(p),b=r(16),h=a(b),y=r(17),k=a(y),w=function(){function e(){n(this,e)}return l(e,null,[{key:"get",value:function(e,t,r){return e.__kb&&Object.prototype.hasOwnProperty.call(e.__kb,t)?e.__kb[t]:r}},{key:"set",value:function(e,t,r){return(e.__kb||(e.__kb={}))[t]=r,r}},{key:"orSet",value:function(e,t,r){return e.__kb||(e.__kb={}),Object.prototype.hasOwnProperty.call(e.__kb,t)||(e.__kb[t]=r),e.__kb[t]}},{key:"has",value:function(e,t){return e.__kb&&Object.prototype.hasOwnProperty.call(e.__kb,t)}},{key:"wrappedObservable",value:function(e,t){return 1===arguments.length?_.default.utils.get(e,"observable"):_.default.utils.set(e,"observable",t)}},{key:"wrappedObject",value:function(e,t){return 1===arguments.length?_.default.utils.get(e,"object"):_.default.utils.set(e,"object",t)}},{key:"wrappedCreator",value:function(e,t){return 1===arguments.length?_.default.utils.get(e,"creator"):_.default.utils.set(e,"creator",t)}},{key:"wrappedModel",value:function(e,t){return 1!==arguments.length?_.default.utils.set(e,"object",t):(t=_.default.utils.get(e,"object"),i.default.isUndefined(t)?e:t)}},{key:"wrappedStore",value:function(e,t){return 1===arguments.length?_.default.utils.get(e,"store"):_.default.utils.set(e,"store",t)}},{key:"wrappedStoreIsOwned",value:function(e,t){return 1===arguments.length?_.default.utils.get(e,"store_is_owned"):_.default.utils.set(e,"store_is_owned",t)}},{key:"wrappedFactory",value:function(e,t){return 1===arguments.length?_.default.utils.get(e,"factory"):_.default.utils.set(e,"factory",t)}},{key:"wrappedEventWatcher",value:function(e,t){return 1===arguments.length?_.default.utils.get(e,"event_watcher"):_.default.utils.set(e,"event_watcher",t)}},{key:"wrappedEventWatcherIsOwned",value:function(e,t){return 1===arguments.length?_.default.utils.get(e,"event_watcher_is_owned"):_.default.utils.set(e,"event_watcher_is_owned",t)}},{key:"valueType",value:function(e){return e?e.__kb_is_o?e.valueType():e.__kb_is_co||_.default.isCollection(e)?_.default.TYPE_COLLECTION:e instanceof _.default.ViewModel||_.default.isModel(e)?_.default.TYPE_MODEL:i.default.isArray(e)?_.default.TYPE_ARRAY:_.default.TYPE_SIMPLE:_.default.TYPE_UNKNOWN}},{key:"pathJoin",value:function(e,t){return(e?"."!==e[e.length-1]?e+".":e:"")+t}},{key:"optionsPathJoin",value:function(e,t){return i.default.defaults({path:this.pathJoin(e.path,t)},e)}},{key:"inferCreator",value:function(e,t,r){var a=t?t.creatorForPath(e,r):null;return a?a:e?e instanceof s.default.Model?_.default.ViewModel:e instanceof s.default.Collection?_.default.CollectionObservable:null:null}},{key:"createFromDefaultCreator",value:function(e,t){return _.default.isModel(e)?_.default.viewModel(e,t):_.default.isCollection(e)?_.default.collectionObservable(e,t):i.default.isArray(e)?f.default.observableArray(e):f.default.observable(e)}},{key:"resolveModel",value:function(e){return e&&s.default&&s.default.ModelRef&&e instanceof s.default.ModelRef?e.model():e}}]),e}();w.wrappedDestroy=v.default,w.collapseOptions=h.default,w.unwrapModels=k.default,t.default=w},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.viewModel=void 0;var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),u=r(0),i=a(u),o=r(3),s=a(o),d=r(2),f=a(d),c=r(1),_=a(c),p=r(4),v=a(p),b=function(e,t){var r=e.__kb.internals&&~i.default.indexOf(e.__kb.internals,t)?"_"+t:t;if(!Object.prototype.hasOwnProperty.call(e.__kb.view_model,r))return e.__kb.view_model[r]=null,r},h=function(e,t,r,a){if(!(e.__kb.excludes&&~i.default.indexOf(e.__kb.excludes,r)||e.__kb.statics&&~i.default.indexOf(e.__kb.statics,r))){var n=b(e,r);if(n){var l=_.default.observable(t,r,a,e);return e.__kb.view_model[n]=l,e[n]=l,l}}},y=function(e,t){i.default.each(e.__kb.statics,function(r){var a=b(e,r);a&&(t.has(a)?(e.__kb.view_model[a]=t.get(a),e[a]=e.__kb.view_model[a]):e.__kb.static_defaults&&Object.prototype.hasOwnProperty.call(e.__kb.static_defaults,a)?(e.__kb.view_model[a]=e.__kb.static_defaults[a],e[a]=e.__kb.view_model[a]):delete e.__kb.view_model[a])})},k=["keys","internals","excludes","statics","static_defaults"],w=function(){function e(){for(var t=this,r=arguments.length,a=Array(r),l=0;l<r;l++)a[l]=arguments[l];return n(this,e),_.default.ignore(function(){var e=a.shift();!e||_.default.isModel(e)||_.default._throwUnexpected(t,"not a model"),i.default.isArray(a[0])&&(a[0]={keys:a[0]}),t.__kb||(t.__kb={}),t.__kb.view_model=a.length>1?a.pop():t;var r={};i.default.each(a,function(e){_.default.assign(r,e),r=_.default.utils.collapseOptions(r)}),i.default.each(k,function(e){Object.prototype.hasOwnProperty.call(r,e)&&(t.__kb[e]=r[e])}),_.default.Store.useOptionsOrCreate(r,e,t),t.__kb.path=r.path,_.default.Factory.useOptionsOrCreate(r,t,r.path);var n=_.default.utils.wrappedEventWatcher(t,new v.default(e,t,{emitter:t._model,update:function(){return _.default.ignore(function(){return!(n&&n.ee)||t.createObservables(n.ee)})}})),l=_.default.utils.set(t,"_model",f.default.observable());return t.model=f.default.computed({read:function(){return f.default.utils.unwrapObservable(l)},write:function(e){return _.default.ignore(function(){if(_.default.utils.wrappedObject(t)!==e&&!_.default.wasReleased(t)&&n)return t.__kb.store.reuse(t,_.default.utils.resolveModel(e)),n.emitter(e),l(n.ee),!n.ee||t.createObservables(n.ee)})}}),e=n.ee,_.default.utils.wrappedObject(t,e),l(n.ee),t.__kb.create_options={store:_.default.utils.wrappedStore(t),factory:_.default.utils.wrappedFactory(t),path:t.__kb.path,event_watcher:_.default.utils.wrappedEventWatcher(t)},!r.requires||t.createObservables(e,r.requires),!t.__kb.internals||t.createObservables(e,t.__kb.internals),!r.mappings||t.createObservables(e,r.mappings),!t.__kb.statics||y(t,e),t.createObservables(e,t.__kb.keys),_.default.statistics&&_.default.statistics.register("ViewModel",t),t})}return l(e,null,[{key:"initClass",value:function(){e.extend=s.default.Model.extend}}]),l(e,[{key:"destroy",value:function(){var e=this;this.__kb_released=!0,this.__kb.view_model!==this&&i.default.each(this.__kb.vm_keys,function(t){e.__kb.view_model[t]=null}),this.__kb.view_model=null,this.__kb.create_options=null,_.default.releaseKeys(this),_.default.utils.wrappedDestroy(this),_.default.statistics&&_.default.statistics.unregister("ViewModel",this)}},{key:"shareOptions",value:function(){return{store:_.default.utils.wrappedStore(this),factory:_.default.utils.wrappedFactory(this)}}},{key:"createObservables",value:function(e,t){var r=this;if(t)i.default.isArray(t)?i.default.map(t,function(t){return h(r,e,t,r.__kb.create_options)}):i.default.each(t,function(t,a){var n=b(r,a);n&&(i.default.isString(t)||t.key||(t.key=n),r[n]=_.default.observable(e,t,r.__kb.create_options,r),r.__kb.view_model[n]=r[n])});else{if(this.__kb.keys||!e)return;for(var a in e.attributes)Object.prototype.hasOwnProperty.call(e.attributes,a)&&h(this,e,a,this.__kb.create_options);_.default.settings.orm&&_.default.settings.orm.keys&&i.default.each(_.default.settings.orm.keys(e),function(t){h(r,e,t,r.__kb.create_options)})}}}]),e}();t.default=w,w.initClass();t.viewModel=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return new(Function.prototype.bind.apply(w,[null].concat(t)))}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),l=a(n),u=r(1),i=a(u),o=function(e,t,r){return e[t]||(e[t]=[]),l.default.isArray(r)||(r=[r]),e[t]=e[t].length?l.default.union(e[t],r):r,e},s=function(e,t,r){return e[t]||(e[t]={}),i.default.assign(e[t],r)},d=function(e){var t={};return l.default.each(e,function(e){t[e]={key:e}}),t},f=function e(t,r){return r?(l.default.each(r,function(e,r){switch(r){case"internals":case"requires":case"excludes":case"statics":o(t,r,e);break;case"keys":l.default.isObject(e)&&!l.default.isArray(e)||l.default.isObject(t[r])&&!l.default.isArray(t[r])?(l.default.isObject(e)||(e=[e]),l.default.isArray(e)&&(e=d(e)),l.default.isArray(t[r])&&(t[r]=d(t[r])),s(t,r,e)):o(t,r,e);break;case"factories":l.default.isFunction(e)?t[r]=e:s(t,r,e);break;case"static_defaults":s(t,r,e);break;case"options":break;default:t[r]=e}}),e(t,r.options)):t};t.default=function(e){return f({},e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default=function(e){if(!e)return e;if(e.__kb)return Object.prototype.hasOwnProperty.call(e.__kb,"object")?e.__kb.object:e;if(n.default.isArray(e))return n.default.map(e,function(e){return unwrapModels(e)});if(n.default.isObject(e)&&e.constructor==={}.constructor){var t={};return n.default.each(e,function(e,r){t[r]=unwrapModels(e)}),t}return e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function e(t){if(t.__kb){t.__kb.event_watcher&&t.__kb.event_watcher.releaseCallbacks(t);var r=t.__kb;if(t.__kb=null,r.observable&&(r.observable.destroy=null,r.observable.release=null,e(r.observable),r.observable=null),r.factory=null,r.event_watcher_is_owned&&r.event_watcher.destroy(),r.event_watcher=null,r.store_is_owned&&r.store.destroy(),r.store=null,r.stores_references)for(var a=r.stores_references.pop();a;)a.store.__kb_released||a.store.release(t),a=r.stores_references.pop()}};t.default=a},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var n=r(0),l=a(n),u=r(3),i=a(u),o=r(2),s=a(o);r(10);var d=r(1),f=a(d),c=r(6),_=a(c),p=r(7),v=a(p),b=r(4),h=a(b),y=r(8),k=a(y),w=r(9),m=r(11),g=a(m),O=r(12),M=a(O),C=r(13),P=a(C),E=r(14),j=a(E),T=r(15),A=a(T),R={_:l.default,Backbone:i.default,ko:s.default,CollectionObservable:_.default,collectionObservable:c.collectionObservable,observableCollection:c.collectionObservable,compare:c.compare,configure:v.default,settings:p.settings,EventWatcher:h.default,Factory:k.default,RECUSIVE_AUTO_INJECT:w.RECUSIVE_AUTO_INJECT,injectViewModels:w.injectViewModels,Observable:g.default,observable:m.observable,Statistics:M.default,Store:P.default,utils:j.default,ViewModel:A.default,viewModel:T.viewModel};f.default.assign(f.default,R),e.exports=f.default},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),u=r(0),i=a(u),o=r(2),s=a(o),d=r(1),f=a(d),c=function(){function e(t){n(this,e),this.create_options=t,this._vo=s.default.observable(null)}return l(e,[{key:"destroy",value:function(){this.__kb_released=!0;var e=this.__kb_value;e&&(this.__kb_value=null,this.create_options.store&&f.default.utils.wrappedCreator(e)?this.create_options.store.release(e):f.default.release(e)),this.create_options=null}},{key:"value",value:function(){return s.default.utils.unwrapObservable(this._vo())}},{key:"rawValue",value:function(){return this.__kb_value}},{key:"valueType",value:function(e,t){var r=f.default.getValue(e,t);return this.value_type||this._updateValueObservable(r),this.value_type}},{key:"update",value:function(e){if(!this.__kb_released){void 0!==e||(e=null);var t=f.default.utils.valueType(e);this.__kb_value&&this.__kb_value.__kb_released&&(this.__kb_value=void 0,this.value_type=void 0);var r=this.__kb_value;switch(this.value_type){case f.default.TYPE_COLLECTION:if(this.value_type===f.default.TYPE_COLLECTION&&t===f.default.TYPE_ARRAY)return r(e);if(t===f.default.TYPE_COLLECTION||i.default.isNull(e))return void(e&&e instanceof f.default.CollectionObservable?this._updateValueObservable(f.default.utils.wrappedObject(e),e):f.default.peek(r.collection)!==e&&r.collection(e));break;case f.default.TYPE_MODEL:if(t===f.default.TYPE_MODEL||i.default.isNull(e))return void(e&&!f.default.isModel(e)?this._updateValueObservable(f.default.utils.wrappedObject(e),e):f.default.utils.wrappedObject(r)!==f.default.utils.resolveModel(e)&&this._updateValueObservable(e))}if(this.value_type!==t||i.default.isUndefined(this.value_type)){if(f.default.peek(r)!==e)return this._updateValueObservable(e)}else if(f.default.peek(r)!==e)return r(e)}}},{key:"_updateValueObservable",value:function(e,t){var r=this.create_options,a=f.default.utils.inferCreator(e,r.factory,r.path);null!==e||a||(this.value_type===f.default.TYPE_MODEL?a=f.default.ViewModel:this.value_type===f.default.TYPE_COLLECTION&&(a=f.default.CollectionObservable)),r.creator=a;var n=f.default.TYPE_UNKNOWN,l=this.__kb_value;this.__kb_value=void 0;var u=void 0;return t?(u=t,r.store&&r.store.retain(t,e,a)):a?r.store?u=r.store.retainOrCreate(e,r,!0):a.models_only?(u=e,n=f.default.TYPE_SIMPLE):u=a.create?a.create(e,r):new a(e,r):i.default.isArray(e)?(n=f.default.TYPE_ARRAY,u=s.default.observableArray(e)):(n=f.default.TYPE_SIMPLE,u=s.default.observable(e)),this.value_type=n,n===f.default.TYPE_UNKNOWN&&(s.default.isObservable(u)?u.__kb_is_co?(this.value_type=f.default.TYPE_COLLECTION,f.default.utils.wrappedObject(u,e)):this.value_type||(this.value_type=f.default.TYPE_SIMPLE):(this.value_type=f.default.TYPE_MODEL,f.default.utils.wrappedObject(u,f.default.utils.resolveModel(e)))),l&&(this.create_options.store?this.create_options.store.release(l):f.default.release(l)),this.__kb_value=u,this._vo(u)}}]),e}();t.default=c},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),u=r(0),i=a(u),o=r(3),s=a(o),d=r(1),f=a(d),c=null,_=function(){function e(){n(this,e)}return l(e,null,[{key:"isAvailable",value:function(){return!!(c=s.default?s.default.AssociatedModel:null)}},{key:"keys",value:function(e){return e instanceof c?i.default.map(e.relations,function(e){return e.key}):null}},{key:"relationType",value:function(e,t){if(!(e instanceof c))return null;var r=i.default.find(e.relations,function(e){return e.key===t});return r?"Many"===r.type?f.default.TYPE_COLLECTION:f.default.TYPE_MODEL:null}}]),e}();t.default=_},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),u=r(0),i=a(u),o=r(3),s=a(o),d=r(1),f=a(d),c=null,_=function(){function e(){n(this,e)}return l(e,null,[{key:"isAvailable",value:function(){return!!(c=s.default?s.default.RelationalModel:null)}},{key:"relationType",value:function(e,t){if(!(e instanceof c))return null;var r=i.default.find(e.getRelations(),function(e){return e.key===t});return r?r.collectionType||i.default.isArray(r.keyContents)?f.default.TYPE_COLLECTION:f.default.TYPE_MODEL:null}},{key:"customBind",value:function(e,t,r,a){var n=this.relationType(e,t);if(!n)return null;var l=function(e){return f.default.statistics&&f.default.statistics.addModelEvent({name:"update (relational)",model:e,key:t,path:a}),r()},u=s.default.Relation.prototype.sanitizeOptions?["update","add","remove"]:["change","add","remove"];return n===f.default.TYPE_COLLECTION?i.default.each(u,function(r){return e.bind(r+":"+t,l)}):e.bind(u[0]+":"+t,l),function(){n===f.default.TYPE_COLLECTION?i.default.each(u,function(r){return e.unbind(r+":"+t,l)}):e.unbind(u[0]+":"+t,l)}}}]),e}();t.default=_}])});